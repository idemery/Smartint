function lcidToLanguage(a) { switch (a) { case 1025: return "ar"; case 1026: return "bg"; case 1027: return "ca"; case 1029: return "cs"; case 1031: return "de"; case 1033: return "en"; case 1034: return "es"; case 1036: return "fr"; case 1038: return "hu"; case 1040: return "it"; case 1041: return "jp"; case 1042: return "ko"; case 1043: return "nl"; case 1044: return "no"; case 1045: return "pl"; case 1046: return "pt_BR"; case 1049: return "ru"; case 1055: return "tr"; case 1065: return "fa"; case 2052: return "zh_CN"; default: return "en" } } function run_smartint(a, b, c, d, e, f, g, h, i) { var j = { url: "php/connector.php", lang: lcidToLanguage(a), title: c, customData: { rootTarget: "/" + i + "/" + c, dropboxRoot: "sandbox", rootFolder: c, token_data: g, consumerKey: e, consumerSecret: f, license: d }, commands: ["open", "reload", "home", "up", "back", "forward", "sim", "download", "rm", "rename", "mkdir", "upload", "copy", "cut", "paste", "sort"], commandsOptions: { help: { view: ["shortcuts"] } }, uiOptions: { toolbar: [["back", "forward"], ["reload"], ["home", "up"], ["mkdir", "upload"], ["open", "download"], ["sim"], ["rename", "copy", "cut", "paste"], ["rm"], ["help"]], tree: { openRootOnLoad: !0, syncTree: !0 }, navbar: { minWidth: 150, maxWidth: 380 }, cwd: { oldSchool: !1 } }, contextmenu: { navbar: ["open", "|", "rename", "copy", "cut", "paste", "|", "rm"], cwd: ["reload", "back", "|", "upload", "mkdir", "paste"], files: ["open", "|", "download", "|", "sim", "|", "rename", "copy", "cut", "paste", "|", "rm"] }, notifyDelay: 100, allowNav: 1 }; window.elfinder_global_instance = $("#smartint").elfinder(j).elfinder("instance"), h && $("#smartint .elfinder-navbar").hide() } function prepare_field_name(a, b, c, d, e, f, g, h) { var i, j, m, k = "qg_smartintcustomentity", l = "?$select=qg_FieldName&$filter=qg_EntityName eq '" + b + "'", n = window.parent.Xrm.Page.context.getClientUrl(); m = n + "/XRMServices/2011/OrganizationData.svc/" + k + "Set" + l, $.ajax({ type: "GET", contentType: "application/json; charset=utf-8", datatype: "json", url: m, beforeSend: function (a) { a.setRequestHeader("Accept", "application/json") }, success: function (k) { var n = k.d.results, o = n[0]; null != o ? (i = o.qg_FieldName, i && window.parent.Xrm.Page.getAttribute(i) ? (j = window.parent.Xrm.Page.getAttribute(i).getValue(), run_smartint(a, b, j, c, d, e, f, g, h)) : alert("No data found for field: " + i + " and entity: " + b)) : alert("No field name was found for entity: " + b) }, error: function (a, b, c) { alert("Status: " + b + "; ErrorThrown: " + c) } }) } function prepare_entity_display_name(a, b, c, d, e, f, g, h) { SDK.Metadata.RetrieveEntity(SDK.Metadata.EntityFilters.Entity, b, null, !1, function (i) { var j = i.DisplayCollectionName.UserLocalizedLabel.Label; if (g) prepare_field_name(a, b, c, d, e, f, h, j); else { if (!window.parent.Xrm.Page.getAttribute(i.PrimaryNameAttribute)) return alert("Primary attribute was not found: " + i.PrimaryNameAttribute), void 0; var k = window.parent.Xrm.Page.getAttribute(i.PrimaryNameAttribute).getValue(); run_smartint(a, b, k, c, d, e, f, h, j) } }, function (a) { alert(a.message) }) } function check_license(a, b, c) { $.getJSON("http://quitegeek.com/?edd_action=check_license&item_name=Smartint%202&license=" + c.qg_License + "&url=" + window.location.origin, function (d) { if (!d) return alert("Smartint is down, This rarely happens. Please try again in few seconds."), void 0; if ("valid" == d.license) { var e = d.consumer_key, f = d.consumer_secret; prepare_entity_display_name(a, b, c.qg_License, e, f, c.qg_token, c.qg_FieldOfFolderName, c.qg_DisableLeftNavigationPanel) } else alert("Your license is invalid. If you believe that your license is valid, please contact our support.") }) } function prepare_settings(a, b) { var e, c = "qg_smartintsettings", d = "?$select=qg_token,qg_License,qg_FieldOfFolderName,qg_DisableLeftNavigationPanel&$orderby=ModifiedOn desc&$top=1", f = window.parent.Xrm.Page.context.getClientUrl(); e = f + "/XRMServices/2011/OrganizationData.svc/" + c + "Set" + d, $.ajax({ type: "GET", contentType: "application/json; charset=utf-8", datatype: "json", url: e, beforeSend: function (a) { a.setRequestHeader("Accept", "application/json") }, success: function (c) { var f = c.d.results, g = f[0]; null != g ? check_license(a, b, g) : alert("No settings were found") }, error: function (a, b, c) { alert("Status: " + b + "; ErrorThrown: " + c) } }) } base64 = new Nibbler({ dataBits: 8, codeBits: 6, keyString: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", pad: "" }), $(function () { var a = window.parent.Xrm.Page.context.getUserLcid(), b = window.parent.Xrm.Page.data.entity.getEntityName(); prepare_settings(a, b) });