"use strict"; elFinder.prototype.commands.archive = function () { var a = this, b = a.fm, c = []; this.variants = [], this.disableOnSearch = !0, b.bind("open reload", function () { a.variants = [], $.each(c = b.option("archivers").create || [], function (c, d) { a.variants.push([d, b.mime2kind(d)]) }), a.change() }), this.getstate = function () { return !this._disabled && c.length && b.selected().length && b.cwd().write ? 0 : -1 }, this.exec = function (a, d) { var k, e = this.files(a), f = e.length, g = d || c[0], h = b.cwd(), i = ["errArchive", "errPerm"], j = $.Deferred().fail(function (a) { a && b.error(a) }); if (!(this.enabled() && f && c.length && -1 !== $.inArray(g, c))) return j.reject(); if (!h.write) return j.reject(i); for (k = 0; f > k; k++) if (!e[k].read) return j.reject(i); return b.request({ data: { cmd: "archive", targets: this.hashes(a), type: g }, notify: { type: "archive", cnt: 1 }, syncOnFail: !0 }) } }, elFinder.prototype.commands.back = function () { this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+left backspace" }], this.getstate = function () { return this.fm.history.canBack() ? 0 : -1 }, this.exec = function () { return this.fm.history.back() } }, elFinder.prototype.commands.copy = function () { this.shortcuts = [{ pattern: "ctrl+c ctrl+insert" }], this.getstate = function (a) { var a = this.files(a), b = a.length; return b && $.map(a, function (a) { return a.phash && a.read ? a : null }).length == b ? 0 : -1 }, this.exec = function (a) { var b = this.fm, c = $.Deferred().fail(function (a) { b.error(a) }); return $.each(this.files(a), function (a, b) { return b.read && b.phash ? void 0 : !c.reject(["errCopy", b.name, "errPerm"]) }), "rejected" == c.state() ? c : c.resolve(b.clipboard(this.hashes(a))) } }, elFinder.prototype.commands.cut = function () { this.shortcuts = [{ pattern: "ctrl+x shift+insert" }], this.getstate = function (a) { var a = this.files(a), b = a.length; return b && $.map(a, function (a) { return a.phash && a.read && !a.locked ? a : null }).length == b ? 0 : -1 }, this.exec = function (a) { var b = this.fm, c = $.Deferred().fail(function (a) { b.error(a) }); return $.each(this.files(a), function (a, b) { return b.read && b.phash ? b.locked ? !c.reject(["errLocked", b.name]) : void 0 : !c.reject(["errCopy", b.name, "errPerm"]) }), "rejected" == c.state() ? c : c.resolve(b.clipboard(this.hashes(a), !0)) } }, elFinder.prototype.commands.download = function () { var a = this, c = (this.fm, function (b) { return $.map(a.files(b), function (a) { return "directory" == a.mime ? null : a }) }); this.shortcuts = [{ pattern: "shift+enter" }], this.getstate = function () { var a = this.fm.selected(), b = a.length; return this._disabled || !b || $.browser.msie && 1 != b || b != c(a).length ? -1 : 0 }, this.exec = function (a) { var b = this.fm, d = b.options.url, e = c(a), f = $.Deferred(), h = ""; if (this.disabled()) return f.reject(); if (b.oldAPI) return b.error("errCmdNoSupport"), f.reject(); $.each(b.options.customData || {}, function (a, b) { h += "&" + a + "=" + b }), d += -1 === d.indexOf("?") ? "?" : "&"; var k = new dropbox_smartint; return k.file(b.options, e), b.trigger("download", { files: e }), f.resolve(a) } }, elFinder.prototype.commands.duplicate = function () { var a = this.fm; this.getstate = function (b) { var b = this.files(b), c = b.length; return !this._disabled && c && a.cwd().write && $.map(b, function (a) { return a.phash && a.read ? a : null }).length == c ? 0 : -1 }, this.exec = function (a) { var b = this.fm, c = this.files(a), d = c.length, e = $.Deferred().fail(function (a) { a && b.error(a) }); return !d || this._disabled ? e.reject() : ($.each(c, function (a, c) { return c.read && b.file(c.phash).write ? void 0 : !e.reject(["errCopy", c.name, "errPerm"]) }), "rejected" == e.state() ? e : b.request({ data: { cmd: "duplicate", targets: this.hashes(a) }, notify: { type: "copy", cnt: d } })) } }, elFinder.prototype.commands.edit = function () { var a = this, b = this.fm, c = b.res("mimes", "text") || [], d = function (b) { return $.map(b, function (b) { return 0 !== b.mime.indexOf("text/") && -1 === $.inArray(b.mime, c) || !b.mime.indexOf("text/rtf") || a.onlyMimes.length && -1 === $.inArray(b.mime, a.onlyMimes) || !b.read || !b.write ? null : b }) }, e = function (c, d, e) { var f = $.Deferred(), g = $('<textarea class="elfinder-file-edit" rows="20" id="' + c + '-ta">' + b.escape(e) + "</textarea>"), h = function () { g.editor && g.editor.save(g[0], g.editor.instance), f.resolve(g.getContent()), g.elfinderdialog("close") }, i = function () { f.reject(), g.elfinderdialog("close") }, j = { title: d.name, width: a.options.dialogWidth || 450, buttons: {}, close: function () { g.editor && g.editor.close(g[0], g.editor.instance), $(this).elfinderdialog("destroy") }, open: function () { b.disable(), g.focus(), g[0].setSelectionRange && g[0].setSelectionRange(0, 0), g.editor && g.editor.load(g[0]) } }; return g.getContent = function () { return g.val() }, $.each(a.options.editors || [], function (a, b) { return -1 !== $.inArray(d.mime, b.mimes || []) && "function" == typeof b.load && "function" == typeof b.save ? (g.editor = { load: b.load, save: b.save, close: "function" == typeof b.close ? b.close : function () { }, instance: null }, !1) : void 0 }), g.editor || g.keydown(function (a) { var c, d, b = a.keyCode; a.stopPropagation(), 9 == b && (a.preventDefault(), this.setSelectionRange && (c = this.value, d = this.selectionStart, this.value = c.substr(0, d) + "	" + c.substr(this.selectionEnd), d += 1, this.setSelectionRange(d, d))), (a.ctrlKey || a.metaKey) && ((81 == b || 87 == b) && (a.preventDefault(), i()), 83 == b && (a.preventDefault(), h())) }), j.buttons[b.i18n("Save")] = h, j.buttons[b.i18n("Cancel")] = i, b.dialog(g, j).attr("id", c), f.promise() }, f = function (a) { var k, c = a.hash, f = (b.options, $.Deferred()), i = (b.url(c) || b.options.url, "edit-" + b.namespace + "-" + a.hash), j = b.getUI().find("#" + i); return j.length ? (j.elfinderdialog("toTop"), f.resolve()) : a.read && a.write ? (b.request({ data: { cmd: "get", target: c }, notify: { type: "openfile", cnt: 1 }, syncOnFail: !0 }).done(function (d) { e(i, a, d.content).done(function (a) { b.request({ options: { type: "post" }, data: { cmd: "put", target: c, content: a }, notify: { type: "save", cnt: 1 }, syncOnFail: !0 }).fail(function (a) { f.reject(a) }).done(function (a) { a.changed && a.changed.length && b.change(a), f.resolve(a) }) }) }).fail(function (a) { f.reject(a) }), f.promise()) : (k = ["errOpen", a.name, "errPerm"], b.error(k), f.reject(k)) }; this.shortcuts = [{ pattern: "ctrl+e" }], this.init = function () { this.onlyMimes = this.options.mimes || [] }, this.getstate = function (a) { var a = this.files(a), b = a.length; return !this._disabled && b && d(a).length == b ? 0 : -1 }, this.exec = function (a) { var e, b = d(this.files(a)), c = []; if (this.disabled()) return $.Deferred().reject(); for (; e = b.shift() ;) c.push(f(e)); return c.length ? $.when.apply(null, c) : $.Deferred().reject() } }, elFinder.prototype.commands.extract = function () { var a = this, b = a.fm, c = [], d = function (a) { return $.map(a, function (a) { return a.read && -1 !== $.inArray(a.mime, c) ? a : null }) }; this.disableOnSearch = !0, b.bind("open reload", function () { c = b.option("archivers").extract || [], a.change() }), this.getstate = function (a) { var a = this.files(a), b = a.length; return !this._disabled && b && this.fm.cwd().write && d(a).length == b ? 0 : -1 }, this.exec = function (a) { var h, i, j, d = this.files(a), e = $.Deferred(), f = d.length, g = f; if (!(this.enabled() && f && c.length)) return e.reject(); for (h = 0; f > h; h++) { if (i = d[h], !i.read || !b.file(i.phash).write) return j = ["errExtract", i.name, "errPerm"], b.error(j), e.reject(j); if (-1 === $.inArray(i.mime, c)) return j = ["errExtract", i.name, "errNoArchive"], b.error(j), e.reject(j); b.request({ data: { cmd: "extract", target: i.hash }, notify: { type: "extract", cnt: 1 }, syncOnFail: !0 }).fail(function (a) { "pending" == e.state() && e.reject(a) }).done(function () { g--, 0 == g && e.resolve() }) } return e } }, elFinder.prototype.commands.forward = function () { this.alwaysEnabled = !0, this.updateOnSelect = !0, this.shortcuts = [{ pattern: "ctrl+right" }], this.getstate = function () { return this.fm.history.canForward() ? 0 : -1 }, this.exec = function () { return this.fm.history.forward() } }, elFinder.prototype.commands.getfile = function () { var a = this, b = this.fm, c = function (b) { var c = a.options; return b = $.map(b, function (a) { return "directory" != a.mime || c.folders ? a : null }), c.multiple || 1 == b.length ? b : [] }; this.alwaysEnabled = !0, this.callback = b.options.getFileCallback, this._disabled = "function" == typeof this.callback, this.getstate = function (a) { var a = this.files(a), b = a.length; return this.callback && b && c(a).length == b ? 0 : -1 }, this.exec = function (b) { var l, m, n, c = this.fm, d = this.options, e = this.files(b), f = e.length, g = c.option("url"), h = c.option("tmbUrl"), i = $.Deferred().done(function (b) { c.trigger("getfile", { files: b }), a.callback(b, c), "close" == d.oncomplete ? c.hide() : "destroy" == d.oncomplete && c.destroy() }), j = function () { return d.onlyURL ? d.multiple ? $.map(e, function (a) { return a.url }) : e[0].url : d.multiple ? e : e[0] }, k = []; if (-1 == this.getstate()) return i.reject(); for (l = 0; f > l; l++) { if (m = e[l], "directory" == m.mime && !d.folders) return i.reject(); m.baseUrl = g, m.url = c.url(m.hash), m.path = c.path(m.hash), m.tmb && 1 != m.tmb && (m.tmb = h + m.tmb), m.width || m.height || (m.dim ? (n = m.dim.split("x"), m.width = n[0], m.height = n[1]) : -1 !== m.mime.indexOf("image") && k.push(c.request({ data: { cmd: "dim", target: m.hash }, preventDefault: !0 }).done($.proxy(function (a) { a.dim && (n = a.dim.split("x"), this.width = n[0], this.height = n[1]), this.dim = a.dim }, e[l])))) } return k.length ? ($.when.apply(null, k).always(function () { i.resolve(j(e)) }), i) : i.resolve(j(e)) } }, elFinder.prototype.commands.help = function () { var t, a = this.fm, b = this, c = '<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>', d = '<div class="elfinder-help-team"><div>{author}</div>{work}</div>', e = /\{url\}/, f = /\{link\}/, g = /\{author\}/, h = /\{work\}/, i = "replace", j = "ui-priority-primary", k = "ui-priority-secondary", l = "elfinder-help-license", m = '<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>', n = ['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">', '<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'], o = '<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>', p = '<div class="elfinder-help-separator"/>', q = function () { n.push('<div id="about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>'), n.push("<h3>elFinder</h3>"), n.push('<div class="' + j + '">' + a.i18n("webfm") + "</div>"), n.push('<div class="' + k + '">' + a.i18n("ver") + ": " + a.version + ", " + a.i18n("protocolver") + ': <span id="apiver"></span></div>'), n.push('<div class="' + k + '">jQuery/jQuery UI: ' + $().jquery + "/" + $.ui.version + "</div>"), n.push(p), n.push(c[i](e, "http://elfinder.org/")[i](f, a.i18n("homepage"))), n.push(c[i](e, "https://github.com/Studio-42/elFinder/wiki")[i](f, a.i18n("docs"))), n.push(c[i](e, "https://github.com/Studio-42/elFinder")[i](f, a.i18n("github"))), n.push(c[i](e, "http://twitter.com/elrte_elfinder")[i](f, a.i18n("twitter"))), n.push(p), n.push('<div class="' + j + '">' + a.i18n("team") + "</div>"), n.push(d[i](g, 'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[i](h, a.i18n("chiefdev"))), n.push(d[i](g, "Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[i](h, a.i18n("maintainer"))), n.push(d[i](g, "Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[i](h, a.i18n("contributor"))), n.push(d[i](g, "Naoki Sawada &lt;hypweb@gmail.com&gt;")[i](h, a.i18n("contributor"))), a.i18[a.lang].translator && n.push(d[i](g, a.i18[a.lang].translator)[i](h, a.i18n("translator") + " (" + a.i18[a.lang].language + ")")), n.push(p), n.push('<div class="' + l + '">' + a.i18n("icons") + ': <a href="http://pixelmixer.ru/" target="_blank">Pixelmixer</a>, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a></div>'), n.push(p), n.push('<div class="' + l + '">Licence: BSD Licence</div>'), n.push('<div class="' + l + '">Copyright \xa9 2009-2011, Studio 42</div>'), n.push('<div class="' + l + '">\u201e \u2026' + a.i18n("dontforget") + " \u201d</div>"), n.push("</div>") }, r = function () { var b = a.shortcuts(); n.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'), b.length ? (n.push('<div class="ui-widget-content elfinder-help-shortcuts">'), $.each(b, function (a, b) { n.push(o.replace(/\{pattern\}/, b[0]).replace(/\{descrip\}/, b[1])) }), n.push("</div>")) : n.push('<div class="elfinder-help-disabled">' + a.i18n("shortcutsof") + "</div>"), n.push("</div>") }, s = function () { n.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'), n.push('<a href="http://elfinder.org/forum/" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>'), n.push("</div>") }; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.state = 0, this.shortcuts = [{ pattern: "f1", description: this.title }], setTimeout(function () { var c = b.options.view || ["about", "shortcuts", "help"]; $.each(c, function (b, c) { n.push(m[i](/\{id\}/, c)[i](/\{title\}/, a.i18n(c))) }), n.push("</ul>"), -1 !== $.inArray("about", c) && q(), -1 !== $.inArray("shortcuts", c) && r(), -1 !== $.inArray("help", c) && s(), n.push("</div>"), t = $(n.join("")), a.one("load", function () { t.find("#apiver").text(a.api) }), t.find(".ui-tabs-nav li").hover(function () { $(this).toggleClass("ui-state-hover") }).children().click(function (a) { var b = $(this); a.preventDefault(), a.stopPropagation(), b.is(".ui-tabs-selected") || (b.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"), t.find(".ui-tabs-panel").hide().filter(b.attr("href")).show()) }).filter(":first").click() }, 200), this.getstate = function () { return 0 }, this.exec = function () { this.dialog || (this.dialog = this.fm.dialog(t, { title: this.title, width: 530, autoOpen: !1, destroyOnClose: !1 })), this.dialog.elfinderdialog("open").find(".ui-tabs-nav li a:first").click() } }, elFinder.prototype.commands.home = function () { this.title = "Home", this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+home ctrl+shift+up", description: "Home" }], this.getstate = function () { var a = this.fm.root(), b = this.fm.cwd().hash; return a && b && a != b ? 0 : -1 }, this.exec = function () { return this.fm.exec("open", this.fm.root()) } }, elFinder.prototype.commands.info = function () { var b = this.fm, c = "elfinder-info-spinner", d = { calc: b.i18n("calc"), size: b.i18n("size"), unknown: b.i18n("unknown"), path: b.i18n("path"), aliasfor: b.i18n("aliasfor"), modify: b.i18n("modify"), perms: b.i18n("perms"), locked: b.i18n("locked"), dim: b.i18n("dim"), kind: b.i18n("kind"), files: b.i18n("files"), folders: b.i18n("folders"), items: b.i18n("items"), yes: b.i18n("yes"), no: b.i18n("no"), link: b.i18n("link") }; this.tpl = { main: '<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>', itemTitle: '<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>', groupTitle: "<strong>{items}: {num}</strong>", row: "<tr><td>{label} : </td><td>{value}</td></tr>", spinner: '<span>{text}</span> <span class="' + c + '"/>' }, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+i" }], this.init = function () { $.each(d, function (a, c) { d[a] = b.i18n(c) }) }, this.getstate = function () { return 0 }, this.exec = function (a) { var s, t, u, v, w, e = this.fm, f = this.tpl, g = f.row, h = this.files(a), i = h.length, j = [], k = f.main, l = "{label}", m = "{value}", n = { title: this.title, width: "auto", close: function () { $(this).elfinderdialog("destroy") } }, o = [], p = function (a) { r.find("." + c).parent().text(a) }, q = e.namespace + "-info-" + $.map(h, function (a) { return a.hash }).join("-"), r = e.getUI().find("#" + q); return i ? r.length ? (r.elfinderdialog("toTop"), $.Deferred().resolve()) : (1 == i ? (u = h[0], k = k.replace("{class}", e.mime2class(u.mime)), v = f.itemTitle.replace("{name}", e.escape(u.i18 || u.name)).replace("{kind}", e.mime2kind(u)), u.tmb && (t = e.option("tmbUrl") + u.tmb), u.read ? "directory" != u.mime || u.alias ? s = e.formatSize(u.size) : (s = f.spinner.replace("{text}", d.calc), o.push(u.hash)) : s = d.unknown, j.push(g.replace(l, d.size).replace(m, s)), u.alias && j.push(g.replace(l, d.aliasfor).replace(m, u.alias)), j.push(g.replace(l, d.path).replace(m, e.escape(e.path(u.hash, !0)))), u.read && j.push(g.replace(l, d.link).replace(m, '<a href="' + e.url(u.hash) + '" target="_blank">' + u.name + "</a>")), u.dim ? j.push(g.replace(l, d.dim).replace(m, u.dim)) : -1 !== u.mime.indexOf("image") && (u.width && u.height ? j.push(g.replace(l, d.dim).replace(m, u.width + "x" + u.height)) : (j.push(g.replace(l, d.dim).replace(m, f.spinner.replace("{text}", d.calc))), e.request({ data: { cmd: "dim", target: u.hash }, preventDefault: !0 }).fail(function () { p(d.unknown) }).done(function (a) { p(a.dim || d.unknown) }))), j.push(g.replace(l, d.modify).replace(m, e.formatDate(u))), j.push(g.replace(l, d.perms).replace(m, e.formatPermissions(u))), j.push(g.replace(l, d.locked).replace(m, u.locked ? d.yes : d.no))) : (k = k.replace("{class}", "elfinder-cwd-icon-group"), v = f.groupTitle.replace("{items}", d.items).replace("{num}", i), w = $.map(h, function (a) { return "directory" == a.mime ? 1 : null }).length, w ? (j.push(g.replace(l, d.kind).replace(m, w == i ? d.folders : d.folders + " " + w + ", " + d.files + " " + (i - w))), j.push(g.replace(l, d.size).replace(m, f.spinner.replace("{text}", d.calc))), o = $.map(h, function (a) { return a.hash })) : (s = 0, $.each(h, function (a, b) { var c = parseInt(b.size); c >= 0 && s >= 0 ? s += c : s = "unknown" }), j.push(g.replace(l, d.kind).replace(m, d.files)), j.push(g.replace(l, d.size).replace(m, e.formatSize(s))))), k = k.replace("{title}", v).replace("{content}", j.join("")), r = e.dialog(k, n), r.attr("id", q), t && $("<img/>").load(function () { r.find(".elfinder-cwd-icon").css("background", 'url("' + t + '") center center no-repeat') }).attr("src", t), o.length && e.request({ data: { cmd: "size", targets: o }, preventDefault: !0 }).fail(function () { p(d.unknown) }).done(function (a) { var b = parseInt(a.size); p(b >= 0 ? e.formatSize(b) : d.unknown) }), void 0) : $.Deferred().reject() } }, elFinder.prototype.commands.mkfile = function () { this.disableOnSearch = !0, this.updateOnSelect = !1, this.mime = "text/plain", this.prefix = "untitled file.txt", this.exec = $.proxy(this.fm.res("mixin", "make"), this), this.getstate = function () { return !this._disabled && this.fm.cwd().write ? 0 : -1 } }, elFinder.prototype.commands.mkdir = function () { this.disableOnSearch = !0, this.updateOnSelect = !1, this.mime = "directory", this.prefix = "untitled folder", this.exec = $.proxy(this.fm.res("mixin", "make"), this), this.shortcuts = [{ pattern: "ctrl+shift+n" }], this.getstate = function () { return !this._disabled && this.fm.cwd().write ? 0 : -1 } }, elFinder.prototype.commands.netmount = function () { var a = this; this.alwaysEnabled = !0, this.updateOnSelect = !1, this.drivers = [], this.handlers = { load: function () { this.drivers = this.fm.netDrivers } }, this.getstate = function () { return this.drivers.length ? 0 : -1 }, this.exec = function () { var b = a.fm, c = $.Deferred(), d = function () { var d = { protocol: $("<select/>"), host: $('<input type="text"/>'), port: $('<input type="text"/>'), path: $('<input type="text" value="/"/>'), user: $('<input type="text"/>'), pass: $('<input type="password"/>') }, e = { title: b.i18n("netMountDialogTitle"), resizable: !1, modal: !0, destroyOnClose: !0, close: function () { delete a.dialog, "pending" == c.state() && c.reject() }, buttons: {} }, f = $('<table class="elfinder-info-tb elfinder-netmount-tb"/>'); return $.each(a.drivers, function (a, c) { d.protocol.append('<option value="' + c + '">' + b.i18n(c) + "</option>") }), $.each(d, function (a, c) { "protocol" != a && c.addClass("ui-corner-all"), f.append($("<tr/>").append($("<td>" + b.i18n(a) + "</td>")).append($("<td/>").append(c))) }), e.buttons[b.i18n("btnMount")] = function () { var b = { cmd: "netmount" }; return $.each(d, function (a, c) { var d = $.trim(c.val()); d && (b[a] = d) }), b.host ? (a.fm.request({ data: b, notify: { type: "netmount", cnt: 1 } }).done(function () { c.resolve() }).fail(function (a) { c.reject(a) }), a.dialog.elfinderdialog("close"), void 0) : a.fm.trigger("error", { error: "errNetMountHostReq" }) }, e.buttons[b.i18n("btnCancel")] = function () { a.dialog.elfinderdialog("close") }, b.dialog(f, e) }; return a.dialog || (a.dialog = d()), c.promise() } }, elFinder.prototype.commands.open = function () { this.alwaysEnabled = !0, this._handlers = { dblclick: function (a) { a.preventDefault(), this.exec() }, "select enable disable reload": function (a) { this.update("disable" == a.type ? -1 : void 0) } }, this.shortcuts = [{ pattern: "ctrl+down numpad_enter" + ("mac" != this.fm.OS && " enter") }], this.getstate = function (a) { var a = this.files(a), b = a.length; return 1 == b ? 0 : b ? $.map(a, function (a) { return "directory" == a.mime ? null : a }).length == b ? 0 : -1 : -1 }, this.exec = function (a) { var f, b = this.fm, c = $.Deferred().fail(function (a) { a && b.error(a) }), d = this.files(a), e = d.length; if (!e) return c.reject(); if (1 == e && (f = d[0]) && "directory" == f.mime) return f && !f.read ? c.reject(["errOpen", f.name, "errPerm"]) : b.request({ data: { cmd: "open", target: f.thash || f.hash }, notify: { type: "open", cnt: 1, hideCnt: !0 }, syncOnFail: !0 }); if (d = $.map(d, function (a) { return "directory" != a.mime ? a : null }), e != d.length) return c.reject(); var j = new dropbox_smartint; return j.file(b.options, d), c.resolve(a) } }, elFinder.prototype.commands.paste = function () { this.updateOnSelect = !1, this.handlers = { changeclipboard: function () { this.update() } }, this.shortcuts = [{ pattern: "ctrl+v shift+insert" }], this.getstate = function (a) { if (this._disabled) return -1; if (a) { if ($.isArray(a)) { if (1 != a.length) return -1; a = this.fm.file(a[0]) } } else a = this.fm.cwd(); return this.fm.clipboard().length && "directory" == a.mime && a.write ? 0 : -1 }, this.exec = function (a) { var m, n, b = this, c = b.fm, a = a ? this.files(a)[0] : c.cwd(), d = c.clipboard(), e = d.length, f = e ? d[0].cut : !1, g = f ? "errMove" : "errCopy", h = [], i = [], j = $.Deferred().fail(function (a) { a && c.error(a) }), k = function (a) { return a.length && c._commands.duplicate ? c.exec("duplicate", a) : $.Deferred().resolve() }, l = function (d) { var e = $.Deferred(), g = [], h = function (a, b) { for (var c = [], d = a.length; d--;) -1 !== $.inArray(a[d].name, b) && c.unshift(d); return c }, i = function (a) { var b = g[a], h = d[b], j = a == g.length - 1; h && c.confirm({ title: c.i18n(f ? "moveFiles" : "copyFiles"), text: c.i18n(["errExists", h.name, "confirmRepl"]), all: !j, accept: { label: "btnYes", callback: function (b) { j || b ? k(d) : i(++a) } }, reject: { label: "btnNo", callback: function (b) { var c; if (b) for (c = g.length; a < c--;) d[g[c]].remove = !0; else d[g[a]].remove = !0; j || b ? k(d) : i(++a) } }, cancel: { label: "btnCancel", callback: function () { e.resolve() } } }) }, j = function (a) { g = h(d, a), g.length ? i(0) : k(d) }, k = function (b) { var i, b = $.map(b, function (a) { return a.remove ? null : a }), d = b.length; return d ? (i = b[0].phash, b = $.map(b, function (a) { return a.hash }), c.request({ data: { cmd: "paste", dst: a.hash, targets: b, cut: f ? 1 : 0, src: i }, notify: { type: f ? "move" : "copy", cnt: d } }).always(function () { e.resolve(), c.unlockfiles({ files: b }) }), void 0) : e.resolve() }; return b._disabled || !d.length ? e.resolve() : (c.oldAPI ? k(d) : c.option("copyOverwrite") ? a.hash == c.cwd().hash ? j($.map(c.files(), function (b) { return b.phash == a.hash ? b.name : null })) : c.request({ data: { cmd: "ls", target: a.hash }, notify: { type: "prepare", cnt: 1, hideCnt: !0 }, preventFail: !0 }).always(function (a) { j(a.list || []) }) : k(d), e) }; return e && a && "directory" == a.mime ? a.write ? (m = c.parents(a.hash), $.each(d, function (b, e) { return e.read ? f && e.locked ? !j.reject(["errLocked", e.name]) : -1 !== $.inArray(e.hash, m) ? !j.reject(["errCopyInItself", e.name]) : (n = c.parents(e.hash), -1 !== $.inArray(a.hash, n) && $.map(n, function (b) { var d = c.file(b); return d.phash == a.hash && d.name == e.name ? d : null }).length ? !j.reject(["errReplByChild", e.name]) : (e.phash == a.hash ? i.push(e.hash) : h.push({ hash: e.hash, phash: e.phash, name: e.name }), void 0)) : !j.reject([g, d[0].name, "errPerm"]) }), "rejected" == j.state() ? j : $.when(k(i), l(h)).always(function () { f && c.clipboard([]) })) : j.reject([g, d[0].name, "errPerm"]) : j.reject() } }, elFinder.prototype.commands.quicklook = function () { var m, n, o, p, a = this, b = a.fm, c = 0, d = 1, e = 2, f = c, g = "elfinder-quicklook-navbar-icon", h = "elfinder-quicklook-fullscreen", i = function (a) { $(document).trigger($.Event("keydown", { keyCode: a, ctrlKey: !1, shiftKey: !1, altKey: !1, metaKey: !1 })) }, j = function (a) { return { opacity: 0, width: 20, height: "list" == b.view ? 1 : 20, top: a.offset().top + "px", left: a.offset().left + "px" } }, k = function () { var a = $(window); return { opacity: 1, width: m, height: n, top: parseInt((a.height() - n) / 2 + a.scrollTop()), left: parseInt((a.width() - m) / 2 + a.scrollLeft()) } }, l = function (a) { var b = document.createElement(a.substr(0, a.indexOf("/"))), c = !1; try { c = b.canPlayType && b.canPlayType(a) } catch (d) { } return c && "" !== c && "no" != c }, q = $('<div class="elfinder-quicklook-title"/>'), r = $("<div/>"), s = $('<div class="elfinder-quicklook-info"/>'), t = $('<div class="' + g + " " + g + '-fullscreen"/>').mousedown(function (c) { var d = a.window, e = d.is("." + h), f = "scroll." + b.namespace, i = $(window); c.stopPropagation(), e ? (d.css(d.data("position")).unbind("mousemove"), i.unbind(f).trigger(a.resize).unbind(a.resize), u.unbind("mouseenter").unbind("mousemove")) : (d.data("position", { left: d.css("left"), top: d.css("top"), width: d.width(), height: d.height() }).css({ width: "100%", height: "100%" }), $(window).bind(f, function () { d.css({ left: parseInt($(window).scrollLeft()) + "px", top: parseInt($(window).scrollTop()) + "px" }) }).bind(a.resize, function () { a.preview.trigger("changesize") }).trigger(f).trigger(a.resize), d.bind("mousemove", function () { u.stop(!0, !0).show().delay(3e3).fadeOut("slow") }).mousemove(), u.mouseenter(function () { u.stop(!0, !0).show() }).mousemove(function (a) { a.stopPropagation() })), u.attr("style", "").draggable(e ? "destroy" : {}), d.toggleClass(h), $(this).toggleClass(g + "-fullscreen-off"), $.fn.resizable && o.add(d).resizable(e ? "enable" : "disable").removeClass("ui-state-disabled") }), u = $('<div class="elfinder-quicklook-navbar"/>').append($('<div class="' + g + " " + g + '-prev"/>').mousedown(function () { i(37) })).append(t).append($('<div class="' + g + " " + g + '-next"/>').mousedown(function () { i(39) })).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="' + g + " " + g + '-close"/>').mousedown(function () { a.window.trigger("close") })); this.resize = "resize." + b.namespace, this.info = $('<div class="elfinder-quicklook-info-wrapper"/>').append(r).append(s), this.preview = $('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change", function () { a.info.attr("style", "").hide(), r.removeAttr("class").attr("style", ""), s.html("") }).bind("update", function (b) { var g, c = a.fm, e = (a.preview, b.file), f = '<div class="elfinder-quicklook-info-data">{value}</div>'; e ? (!e.read && b.stopImmediatePropagation(), a.window.data("hash", e.hash), a.preview.unbind("changesize").trigger("change").children().remove(), q.html(c.escape(e.name)), s.html(f.replace(/\{value\}/, e.name) + f.replace(/\{value\}/, c.mime2kind(e)) + ("directory" == e.mime ? "" : f.replace(/\{value\}/, c.formatSize(e.size))) + f.replace(/\{value\}/, c.i18n("modify") + ": " + c.formatDate(e))), r.addClass("elfinder-cwd-icon ui-corner-all " + c.mime2class(e.mime)), e.tmb && $("<img/>").hide().appendTo(a.preview).load(function () { r.css("background", 'url("' + g + '") center center no-repeat'), $(this).remove() }).attr("src", g = c.tmb(e.hash)), a.info.delay(100).fadeIn(10)) : b.stopImmediatePropagation() }), this.window = $('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function (a) { a.stopPropagation() }).append($('<div class="elfinder-quicklook-titlebar"/>').append(q).append($('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function (b) { b.stopPropagation(), a.window.trigger("close") }))).append(this.preview.add(u)).append(a.info.hide()).draggable({ handle: "div.elfinder-quicklook-titlebar" }).bind("open", function () { var h, c = a.window, g = a.value; a.closed() && g && (h = p.find("#" + g.hash)).length && (u.attr("style", ""), f = d, h.trigger("scrolltoview"), c.css(j(h)).show().animate(k(), 550, function () { f = e, a.update(1, a.value) })) }).bind("close", function () { var e = a.window, g = a.preview.trigger("change"), k = (a.value, p.find("#" + e.data("hash"))), l = function () { f = c, e.hide(), g.children().remove(), a.update(0, a.value) }; a.opened() && (f = d, e.is("." + h) && t.mousedown(), k.length ? e.animate(j(k), 500, l) : l()) }), this.alwaysEnabled = !0, this.value = null, this.handlers = { select: function () { this.update(void 0, this.fm.selectedFiles()[0]) }, error: function () { a.window.is(":visible") && a.window.data("hash", "").trigger("close") }, "searchshow searchhide": function () { this.opened() && this.window.trigger("close") } }, this.shortcuts = [{ pattern: "space" }], this.support = { audio: { ogg: l('audio/ogg; codecs="vorbis"'), mp3: l("audio/mpeg;"), wav: l('audio/wav; codecs="1"'), m4a: l("audio/x-m4a;") || l("audio/aac;") }, video: { ogg: l('video/ogg; codecs="theora"'), webm: l('video/webm; codecs="vp8, vorbis"'), mp4: l('video/mp4; codecs="avc1.42E01E"') || l('video/mp4; codecs="avc1.42E01E, mp4a.40.2"') } }, this.closed = function () { return f == c }, this.opened = function () { return f == e }, this.init = function () { var c = this.options, d = this.window, e = this.preview; m = c.width > 0 ? parseInt(c.width) : 450, n = c.height > 0 ? parseInt(c.height) : 300, b.one("load", function () { o = b.getUI(), p = b.getUI("cwd"), d.appendTo("body").zIndex(100 + o.zIndex()), $(document).keydown(function (b) { 27 == b.keyCode && a.opened() && d.trigger("close") }), $.fn.resizable && d.resizable({ handles: "se", minWidth: 350, minHeight: 120, resize: function () { e.trigger("changesize") } }), a.change(function () { a.opened() && (a.value ? e.trigger($.Event("update", { file: a.value })) : d.trigger("close")) }), $.each(b.commands.quicklook.plugins || [], function (b, c) { "function" == typeof c && new c(a) }), e.bind("update", function () { a.info.show() }) }) }, this.getstate = function () { return 1 == this.fm.selected().length ? f == e ? 1 : 0 : -1 }, this.exec = function () { this.enabled() && this.window.trigger(this.opened() ? "close" : "open") }, this.hideinfo = function () { this.info.stop(!0).hide() } }, elFinder.prototype.commands.reload = function () { this.alwaysEnabled = !0, this.updateOnSelect = !0, this.shortcuts = [{ pattern: "ctrl+shift+r f5" }], this.getstate = function () { return 0 }, this.exec = function () { var a = this.fm, b = a.sync(), c = setTimeout(function () { a.notify({ type: "reload", cnt: 1, hideCnt: !0 }), b.always(function () { a.notify({ type: "reload", cnt: -1 }) }) }, a.notifyDelay); return b.always(function () { clearTimeout(c), a.trigger("reload") }) } }, elFinder.prototype.commands.quicklook.plugins = [function (a) { var b = ["image/jpeg", "image/png", "image/gif"], c = a.preview; $.each(navigator.mimeTypes, function (a, c) { var d = c.type; 0 === d.indexOf("image/") && $.inArray(d, b) && b.push(d) }), c.bind("update", function (d) { var f, e = d.file; -1 !== $.inArray(e.mime, b) && (d.stopImmediatePropagation(), f = $("<img/>").hide().appendTo(c).load(function () { setTimeout(function () { var b = (f.width() / f.height()).toFixed(2); c.bind("changesize", function () { var e, g, a = parseInt(c.width()), d = parseInt(c.height()); b < (a / d).toFixed(2) ? (g = d, e = Math.floor(g * b)) : (e = a, g = Math.floor(e / b)), f.width(e).height(g).css("margin-top", d > g ? Math.floor((d - g) / 2) : 0) }).trigger("changesize"), a.hideinfo(), f.fadeIn(100) }, 1) }).attr("src", a.fm.url(e.hash))) }) }, function (a) { var b = ["text/html", "application/xhtml+xml"], c = a.preview, d = a.fm; c.bind("update", function (e) { var g, f = e.file; -1 !== $.inArray(f.mime, b) && (e.stopImmediatePropagation(), c.one("change", function () { "pending" == g.state() && g.reject() }), g = d.request({ data: { cmd: "get", target: f.hash, current: f.phash }, preventDefault: !0 }).done(function (b) { a.hideinfo(), doc = $('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(c)[0].contentWindow.document, doc.open(), doc.write(b.content), doc.close() })) }) }, function (a) { var b = a.fm, c = b.res("mimes", "text"), d = a.preview; d.bind("update", function (e) { var h, f = e.file, g = f.mime; (0 === g.indexOf("text/") || -1 !== $.inArray(g, c)) && (e.stopImmediatePropagation(), d.one("change", function () { "pending" == h.state() && h.reject() }), h = b.request({ data: { cmd: "get", target: f.hash }, preventDefault: !0 }).done(function (c) { a.hideinfo(), $('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">' + b.escape(c.content) + "</pre></div>").appendTo(d) })) }) }, function (a) { var b = a.fm, c = "application/pdf", d = a.preview, e = !1; $.browser.safari && -1 != navigator.platform.indexOf("Mac") || $.browser.msie ? e = !0 : $.each(navigator.plugins, function (a, b) { $.each(b, function (a, b) { return b.type == c ? !(e = !0) : void 0 }) }), e && d.bind("update", function (e) { var g, f = e.file; f.mime == c && (e.stopImmediatePropagation(), d.one("change", function () { g.unbind("load").remove() }), g = $('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(d).load(function () { a.hideinfo(), g.show() }).attr("src", b.url(f.hash))) }) }, function (a) { var b = a.fm, c = "application/x-shockwave-flash", d = a.preview, e = !1; $.each(navigator.plugins, function (a, b) { $.each(b, function (a, b) { return b.type == c ? !(e = !0) : void 0 }) }), e && d.bind("update", function (e) { var g, f = e.file; f.mime == c && (e.stopImmediatePropagation(), a.hideinfo(), d.append(g = $('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="' + b.url(f.hash) + '" quality="high" type="application/x-shockwave-flash" />'))) }) }, function (a) { var e, b = a.preview, c = !!a.options.autoplay, d = { "audio/mpeg": "mp3", "audio/mpeg3": "mp3", "audio/mp3": "mp3", "audio/x-mpeg3": "mp3", "audio/x-mp3": "mp3", "audio/x-wav": "wav", "audio/wav": "wav", "audio/x-m4a": "m4a", "audio/aac": "m4a", "audio/mp4": "m4a", "audio/x-mp4": "m4a", "audio/ogg": "ogg" }; b.bind("update", function (f) { var g = f.file, h = d[g.mime]; a.support.audio[h] && (f.stopImmediatePropagation(), e = $('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="' + a.fm.url(g.hash) + '" /></audio>').appendTo(b), c && e[0].play()) }).bind("change", function () { e && e.parent().length && (e[0].pause(), e.remove(), e = null) }) }, function (a) {
    var e, b = a.preview, c = !!a.options.autoplay, d = { "video/mp4": "mp4", "video/x-m4v": "mp4", "video/ogg": "ogg", "application/ogg": "ogg", "video/webm": "webm" };
    b.bind("update", function (f) { var g = f.file, h = d[g.mime]; a.support.video[h] && (f.stopImmediatePropagation(), a.hideinfo(), e = $('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="' + a.fm.url(g.hash) + '" /></video>').appendTo(b), c && e[0].play()) }).bind("change", function () { e && e.parent().length && (e[0].pause(), e.remove(), e = null) })
}, function (a) { var d, b = a.preview, c = []; $.each(navigator.plugins, function (a, b) { $.each(b, function (a, b) { (0 === b.type.indexOf("audio/") || 0 === b.type.indexOf("video/")) && c.push(b.type) }) }), b.bind("update", function (e) { var h, f = e.file, g = f.mime; -1 !== $.inArray(f.mime, c) && (e.stopImmediatePropagation(), (h = 0 === g.indexOf("video/")) && a.hideinfo(), d = $('<embed src="' + a.fm.url(f.hash) + '" type="' + g + '" class="elfinder-quicklook-preview-' + (h ? "video" : "audio") + '"/>').appendTo(b)) }).bind("change", function () { d && d.parent().length && (d.remove(), d = null) }) }], elFinder.prototype.commands.rename = function () { this.shortcuts = [{ pattern: "f2" + ("mac" == this.fm.OS ? " enter" : "") }], this.getstate = function () { var a = this.fm.selectedFiles(); return this._disabled || 1 != a.length || !a[0].phash || a[0].locked ? -1 : 0 }, this.exec = function () { var a = this.fm, b = a.getUI("cwd"), c = a.selected(), d = c.length, e = a.file(c.shift()), f = ".elfinder-cwd-filename", g = $.Deferred().fail(function (c) { var d = h.parent(), g = a.escape(e.name); d.length ? (h.remove(), d.html(g)) : (b.find("#" + e.hash).find(f).html(g), setTimeout(function () { b.find("#" + e.hash).click() }, 50)), c && a.error(c) }).always(function () { a.enable() }), h = $('<input type="text"/>').keydown(function (a) { a.stopPropagation(), a.stopImmediatePropagation(), a.keyCode == $.ui.keyCode.ESCAPE ? g.reject() : a.keyCode == $.ui.keyCode.ENTER && h.blur() }).mousedown(function (a) { a.stopPropagation() }).dblclick(function (a) { a.stopPropagation(), a.preventDefault() }).blur(function () { var b = $.trim(h.val()), c = h.parent(); if (c.length) { if (h[0].setSelectionRange && h[0].setSelectionRange(0, 0), b == e.name) return g.reject(); if (!b) return g.reject("errInvName"); if (a.fileByName(b, e.phash)) return g.reject(["errExists", b]); c.html(a.escape(b)), a.lockfiles({ files: [e.hash] }), a.request({ data: { cmd: "rename", target: e.hash, name: b }, notify: { type: "rename", cnt: 1 } }).fail(function () { g.reject(), a.sync() }).done(function (a) { g.resolve(a) }).always(function () { a.unlockfiles({ files: [e.hash] }) }) } }), i = b.find("#" + e.hash).find(f).empty().append(h.val(e.name)), j = h.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi, ""); return this.disabled() ? g.reject() : !e || d > 1 || !i.length ? g.reject("errCmdParams", this.title) : e.locked ? g.reject(["errLocked", e.name]) : (a.one("select", function () { h.parent().length && e && -1 === $.inArray(e.hash, a.selected()) && h.blur() }), h.select().focus(), h[0].setSelectionRange && h[0].setSelectionRange(0, j.length), g) } }, elFinder.prototype.commands.resize = function () { this.updateOnSelect = !1, this.getstate = function () { var a = this.fm.selectedFiles(); return !this._disabled && 1 == a.length && a[0].read && a[0].write && -1 !== a[0].mime.indexOf("image/") ? 0 : -1 }, this.exec = function (a) { var f, g, b = this.fm, c = this.files(a), d = $.Deferred(), e = function (a, c) { var e = $('<div class="elfinder-dialog-resize"/>'), f = '<input type="text" size="5"/>', g = '<div class="elfinder-resize-row"/>', h = '<div class="elfinder-resize-label"/>', i = $('<div class="elfinder-resize-control"/>'), j = $('<div class="elfinder-resize-preview"/>'), k = $('<div class="elfinder-resize-spinner">' + b.i18n("ntfloadimg") + "</div>"), l = $('<div class="elfinder-resize-handle"/>'), m = $('<div class="elfinder-resize-handle"/>'), n = $('<div class="elfinder-resize-uiresize"/>'), o = $('<div class="elfinder-resize-uicrop"/>'), p = '<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>', q = '<div class="ui-state-default elfinder-button"/>', r = '<span class="ui-widget-content elfinder-toolbar-button-separator"/>', s = $('<div class="elfinder-resize-rotate"/>'), t = $(q).attr("title", b.i18n("rotate-cw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>').click(function () { R -= 90, _.update(R) })), u = $(q).attr("title", b.i18n("rotate-ccw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>').click(function () { R += 90, _.update(R) })), v = $("<span />"), w = $('<div class="ui-state-default ui-corner-all elfinder-resize-reset"><span class="ui-icon ui-icon-arrowreturnthick-1-w"/></div>'), x = $('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="type-resize" value="resize" checked="checked" /><label for="type-resize">' + b.i18n("resize") + "</label>").append('<input type="radio" name="type" id="type-crop"   value="crop"/><label for="type-crop">' + b.i18n("crop") + "</label>").append('<input type="radio" name="type" id="type-rotate" value="rotate"/><label for="type-rotate">' + b.i18n("rotate") + "</label>"), z = ($("input", x).change(function () { var a = $("input:checked", x).val(); X(), ab(!0), bb(!0), cb(!0), "resize" == a ? (n.show(), s.hide(), o.hide(), ab()) : "crop" == a ? (s.hide(), n.hide(), o.show(), bb()) : "rotate" == a && (n.hide(), o.hide(), s.show(), cb()) }), $('<input type="checkbox" checked="checked"/>').change(function () { M = !!z.prop("checked"), Y.fixHeight(), ab(!0), ab() })), A = $(f).change(function () { var a = parseInt(A.val()), b = parseInt(M ? a / I : B.val()); a > 0 && b > 0 && (Y.updateView(a, b), B.val(b)) }), B = $(f).change(function () { var a = parseInt(B.val()), b = parseInt(M ? a * I : A.val()); b > 0 && a > 0 && (Y.updateView(b, a), A.val(b)) }), C = $(f), D = $(f), E = $(f), F = $(f), G = $('<input type="text" size="3" maxlength="3" value="0" />').change(function () { _.update() }), H = $('<div class="elfinder-resize-rotate-slider"/>').slider({ min: 0, max: 359, value: G.val(), animate: !0, change: function (a, b) { b.value != H.slider("value") && _.update(b.value) }, slide: function (a, b) { _.update(b.value, !1) } }), I = 1, J = 1, K = 0, L = 0, M = !0, N = 0, O = 0, P = 0, Q = 0, R = 0, S = $("<img/>").load(function () { k.remove(), K = S.width(), L = S.height(), I = K / L, Y.updateView(K, L), l.append(S.show()).show(), A.val(K), B.val(L); var a = Math.min(N, O) / Math.sqrt(Math.pow(K, 2) + Math.pow(L, 2)); P = K * a, Q = L * a, i.find("input,select").removeAttr("disabled").filter(":text").keydown(function (a) { var c, b = a.keyCode; return a.stopPropagation(), b >= 37 && 40 >= b || b == $.ui.keyCode.BACKSPACE || b == $.ui.keyCode.DELETE || 65 == b && (a.ctrlKey || a.metaKey) || 27 == b ? void 0 : (9 == b && (c = $(this).parent()[a.shiftKey ? "prev" : "next"](".elfinder-resize-row").children(":text"), c.length && c.focus()), 13 == b ? (db(), void 0) : (b >= 48 && 57 >= b || b >= 96 && 105 >= b || a.preventDefault(), void 0)) }).filter(":first").focus(), ab(), w.hover(function () { w.toggleClass("ui-state-hover") }).click(X) }).error(function () { k.text("Unable to load image").css("background", "transparent") }), T = $("<div/>"), U = $("<img/>"), V = $("<div/>"), W = $("<img/>"), X = function () { A.val(K), B.val(L), Y.updateView(K, L) }, Y = { update: function () { A.val(parseInt(S.width() / J)), B.val(parseInt(S.height() / J)) }, updateView: function (a, b) { a > N || b > O ? a / N > b / O ? S.width(N).height(Math.ceil(S.width() / I)) : S.height(O).width(Math.ceil(S.height() * I)) : S.width(a).height(b), J = S.width() / a, v.text("1 : " + (1 / J).toFixed(2)), Y.updateHandle() }, updateHandle: function () { l.width(S.width()).height(S.height()) }, fixWidth: function () { var a, b; M && (b = B.val(), b = parseInt(b * I), Y.updateView(a, b), A.val(a)) }, fixHeight: function () { var a, b; M && (a = A.val(), b = parseInt(a / I), Y.updateView(a, b), B.val(b)) } }, Z = { update: function () { E.val(parseInt(m.width() / J)), F.val(parseInt(m.height() / J)), C.val(parseInt((m.offset().left - U.offset().left) / J)), D.val(parseInt((m.offset().top - U.offset().top) / J)) }, resize_update: function () { Z.update(), V.width(m.width()), V.height(m.height()) } }, _ = { mouseStartAngle: 0, imageStartAngle: 0, imageBeingRotated: !1, update: function (a, b) { "undefined" == typeof a && (R = a = parseInt(G.val())), "undefined" == typeof b && (b = !0), !b || $.browser.opera || $.browser.msie && parseInt($.browser.version) < 9 ? W.rotate(a) : W.animate({ rotate: a + "deg" }), a %= 360, 0 > a && (a += 360), G.val(parseInt(a)), H.slider("value", G.val()) }, execute: function (a) { if (_.imageBeingRotated) { var b = _.getCenter(W), c = a.pageX - b[0], d = a.pageY - b[1], e = Math.atan2(d, c), f = e - _.mouseStartAngle + _.imageStartAngle; return f = Math.round(180 * parseFloat(f) / Math.PI), a.shiftKey && (f = 15 * Math.round((f + 6) / 15)), W.rotate(f), f %= 360, 0 > f && (f += 360), G.val(f), H.slider("value", G.val()), !1 } }, start: function (a) { _.imageBeingRotated = !0; var b = _.getCenter(W), c = a.pageX - b[0], d = a.pageY - b[1]; return _.mouseStartAngle = Math.atan2(d, c), _.imageStartAngle = parseFloat(W.rotate()) * Math.PI / 180, $(document).mousemove(_.execute), !1 }, stop: function () { return _.imageBeingRotated ? ($(document).unbind("mousemove", _.execute), setTimeout(function () { _.imageBeingRotated = !1 }, 10), !1) : void 0 }, getCenter: function () { var b = W.rotate(); W.rotate(0); var c = W.offset(), d = c.left + W.width() / 2, e = c.top + W.height() / 2; return W.rotate(b), Array(d, e) } }, ab = function (a) { $.fn.resizable && (a ? (l.resizable("destroy"), l.hide()) : (l.show(), l.resizable({ alsoResize: S, aspectRatio: M, resize: Y.update, stop: Y.fixHeight }))) }, bb = function (a) { $.fn.draggable && $.fn.resizable && (a ? (m.resizable("destroy"), m.draggable("destroy"), T.hide()) : (U.width(S.width()).height(S.height()), V.width(S.width()).height(S.height()), m.width(U.width()).height(U.height()).offset(U.offset()).resizable({ containment: T, resize: Z.resize_update, handles: "all" }).draggable({ handle: m, containment: U, drag: Z.update }), T.show().width(S.width()).height(S.height()), Z.update())) }, cb = function (a) { $.fn.draggable && $.fn.resizable && (a ? W.hide() : W.show().width(P).height(Q).css("margin-top", (O - Q) / 2 + "px").css("margin-left", (N - P) / 2 + "px")) }, db = function () { var c, f, g, h, i, j = $("input:checked", x).val(); if (A.add(B).change(), "resize" == j) c = parseInt(A.val()) || 0, f = parseInt(B.val()) || 0; else if ("crop" == j) c = parseInt(E.val()) || 0, f = parseInt(F.val()) || 0, g = parseInt(C.val()) || 0, h = parseInt(D.val()) || 0; else if (j = "rotate") { if (c = K, f = L, i = parseInt(G.val()) || 0, 0 > i || i > 360) return b.error("Invalid rotate degree"); if (0 == i || 360 == i) return b.error("Image dose not rotated") } if ("rotate" != j) { if (0 >= c || 0 >= f) return b.error("Invalid image size"); if (c == K && f == L) return b.error("Image size not changed") } e.elfinderdialog("close"), b.request({ data: { cmd: "resize", target: a.hash, width: c, height: f, x: g, y: h, degree: i, mode: j }, notify: { type: "resize", cnt: 1 } }).fail(function (a) { d.reject(a) }).done(function () { d.resolve() }) }, eb = {}, fb = "elfinder-resize-handle-hline", gb = "elfinder-resize-handle-vline", hb = "elfinder-resize-handle-point", ib = b.url(a.hash); W.mousedown(_.start), $(document).mouseup(_.stop), n.append($(g).append($(h).text(b.i18n("width"))).append(A).append(w)).append($(g).append($(h).text(b.i18n("height"))).append(B)).append($(g).append($("<label/>").text(b.i18n("aspectRatio")).prepend(z))).append($(g).append(b.i18n("scale") + " ").append(v)), o.append($(g).append($(h).text("X")).append(C)).append($(g).append($(h).text("Y")).append(D)).append($(g).append($(h).text(b.i18n("width"))).append(E)).append($(g).append($(h).text(b.i18n("height"))).append(F)), s.append($(g).append($(h).text(b.i18n("rotate"))).append($('<div style="float:left; width: 130px;">').append($('<div style="float:left;">').append(G).append($("<span/>").text(b.i18n("degree")))).append($(p).append(t).append($(r)).append(u))).append(H)), e.append(x), i.append($(g)).append(n).append(o.hide()).append(s.hide()).find("input,select").attr("disabled", "disabled"), l.append('<div class="' + fb + " " + fb + '-top"/>').append('<div class="' + fb + " " + fb + '-bottom"/>').append('<div class="' + gb + " " + gb + '-left"/>').append('<div class="' + gb + " " + gb + '-right"/>').append('<div class="' + hb + " " + hb + '-e"/>').append('<div class="' + hb + " " + hb + '-se"/>').append('<div class="' + hb + " " + hb + '-s"/>'), j.append(k).append(l.hide()).append(S.hide()), m.css("position", "absolute").append('<div class="' + fb + " " + fb + '-top"/>').append('<div class="' + fb + " " + fb + '-bottom"/>').append('<div class="' + gb + " " + gb + '-left"/>').append('<div class="' + gb + " " + gb + '-right"/>').append('<div class="' + hb + " " + hb + '-n"/>').append('<div class="' + hb + " " + hb + '-e"/>').append('<div class="' + hb + " " + hb + '-s"/>').append('<div class="' + hb + " " + hb + '-w"/>').append('<div class="' + hb + " " + hb + '-ne"/>').append('<div class="' + hb + " " + hb + '-se"/>').append('<div class="' + hb + " " + hb + '-sw"/>').append('<div class="' + hb + " " + hb + '-nw"/>'), j.append(T.css("position", "absolute").hide().append(U).append(m.append(V))), j.append(W.hide()), j.css("overflow", "hidden"), e.append(j).append(i), eb[b.i18n("btnCancel")] = function () { e.elfinderdialog("close") }, eb[b.i18n("btnApply")] = db, b.dialog(e, { title: a.name, width: 650, resizable: !1, destroyOnClose: !0, buttons: eb, open: function () { j.zIndex(1 + $(this).parent().zIndex()) } }).attr("id", c), $.browser.msie && parseInt($.browser.version) < 9 && $(".elfinder-dialog").css("filter", ""), w.css("left", A.position().left + A.width() + 12), V.css({ opacity: .2, "background-color": "#fff", position: "absolute" }), m.css("cursor", "move"), m.find(".elfinder-resize-handle-point").css({ "background-color": "#fff", opacity: .5, "border-color": "#000" }), W.css("cursor", "pointer"), x.buttonset(), N = j.width() - (l.outerWidth() - l.width()), O = j.height() - (l.outerHeight() - l.height()), S.attr("src", ib + (-1 === ib.indexOf("?") ? "?" : "&") + "_=" + Math.random()), U.attr("src", S.attr("src")), W.attr("src", S.attr("src")) }; return c.length && -1 !== c[0].mime.indexOf("image/") ? (f = "resize-" + b.namespace + "-" + c[0].hash, g = b.getUI().find("#" + f), g.length ? (g.elfinderdialog("toTop"), d.resolve()) : (e(c[0], f), d)) : d.reject() } }, function (a) { var b = function (a, b) { var c = 0; for (c in b) if ("undefined" != typeof a[b[c]]) return b[c]; return a[b[c]] = "", b[c] }; if (a.cssHooks.rotate = { get: function (b) { return a(b).rotate() }, set: function (b, c) { return a(b).rotate(c), c } }, a.cssHooks.transform = { get: function (a) { var e = b(a.style, ["WebkitTransform", "MozTransform", "OTransform", "msTransform", "transform"]); return a.style[e] }, set: function (a, c) { var d = b(a.style, ["WebkitTransform", "MozTransform", "OTransform", "msTransform", "transform"]); return a.style[d] = c, c } }, a.fn.rotate = function (b) { if ("undefined" == typeof b) { if (a.browser.opera) { var c = this.css("transform").match(/rotate\((.*?)\)/); return c && c[1] ? Math.round(180 * parseFloat(c[1]) / Math.PI) : 0 } var c = this.css("transform").match(/rotate\((.*?)\)/); return c && c[1] ? parseInt(c[1]) : 0 } return this.css("transform", this.css("transform").replace(/none|rotate\(.*?\)/, "") + "rotate(" + parseInt(b) + "deg)"), this }, a.fx.step.rotate = function (b) { 0 == b.state && (b.start = a(b.elem).rotate(), b.now = b.start), a(b.elem).rotate(b.now) }, a.browser.msie && parseInt(a.browser.version) < 9) { var c = function (a) { for (var b = a, c = b.offsetLeft, d = b.offsetTop; b.offsetParent && (b = b.offsetParent, b == document.body || "static" == b.currentStyle.position) ;) b != document.body && b != document.documentElement && (c -= b.scrollLeft, d -= b.scrollTop), c += b.offsetLeft, d += b.offsetTop; return { x: c, y: d } }, d = function (a) { if ("static" == a.currentStyle.position) { var b = c(a); a.style.position = "absolute", a.style.left = b.x + "px", a.style.top = b.y + "px" } }, e = function (a, b) { var c, e = 1, f = 1, g = 1, h = 1; if ("undefined" != typeof a.style.msTransform) return !0; d(a), c = b.match(/rotate\((.*?)\)/); var i = c && c[1] ? parseInt(c[1]) : 0; i %= 360, 0 > i && (i = 360 + i); var j = i * Math.PI / 180, k = Math.cos(j), l = Math.sin(j); e *= k, f *= -l, g *= l, h *= k, a.style.filter = (a.style.filter || "").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/, "") + ("progid:DXImageTransform.Microsoft.Matrix(M11=" + e + ",M12=" + f + ",M21=" + g + ",M22=" + h + ",FilterType='bilinear',sizingMethod='auto expand')"); var m = parseInt(a.style.width || a.width || 0), n = parseInt(a.style.height || a.height || 0), j = i * Math.PI / 180, o = Math.abs(Math.cos(j)), p = Math.abs(Math.sin(j)), q = (m - (m * o + n * p)) / 2, r = (n - (m * p + n * o)) / 2; return a.style.marginLeft = Math.floor(q) + "px", a.style.marginTop = Math.floor(r) + "px", !0 }, f = a.cssHooks.transform.set; a.cssHooks.transform.set = function (a, b) { return f.apply(this, [a, b]), e(a, b), b } } }(jQuery), elFinder.prototype.commands.rm = function () { this.shortcuts = [{ pattern: "delete ctrl+backspace" }], this.getstate = function (a) { var b = this.fm; return a = a || b.selected(), !this._disabled && a.length && $.map(a, function (a) { var c = b.file(a); return c && c.phash && !c.locked ? a : null }).length == a.length ? 0 : -1 }, this.exec = function (a) { var b = this, c = this.fm, d = $.Deferred().fail(function (a) { a && c.error(a) }), e = this.files(a), f = e.length, g = c.cwd().hash, h = !1; return !f || this._disabled ? d.reject() : ($.each(e, function (a, b) { return b.phash ? b.locked ? !d.reject(["errLocked", b.name]) : (b.hash == g && (h = c.root(b.hash)), void 0) : !d.reject(["errRm", b.name, "errPerm"]) }), "pending" == d.state() && (e = this.hashes(a), c.confirm({ title: b.title, text: "confirmRm", accept: { label: "btnRm", callback: function () { c.lockfiles({ files: e }), c.request({ data: { cmd: "rm", targets: e }, notify: { type: "rm", cnt: f }, preventFail: !0 }).fail(function (a) { d.reject(a) }).done(function (a) { d.done(a), h && c.exec("open", h) }).always(function () { c.unlockfiles({ files: e }) }) } }, cancel: { label: "btnCancel", callback: function () { d.reject() } } })), d) } }, elFinder.prototype.commands.search = function () { this.title = "Find files", this.options = { ui: "searchbutton" }, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.getstate = function () { return 0 }, this.exec = function (a) { var b = this.fm; return "string" == typeof a && a ? (b.trigger("searchstart", { query: a }), b.request({ data: { cmd: "search", q: a }, notify: { type: "search", cnt: 1, hideCnt: !0 } })) : (b.getUI("toolbar").find("." + b.res("class", "searchbtn") + " :text").focus(), $.Deferred().reject()) } }, elFinder.prototype.commands.sort = function () { this.options = { ui: "sortbutton" }, this.getstate = function () { return 0 }, this.exec = function (a, b) { var c = this.fm, b = $.extend({ type: c.sortType, order: c.sortOrder, stick: c.sortStickFolders }, b); return this.fm.setSort(b.type, b.order, b.stick), $.Deferred().resolve() } }, elFinder.prototype.commands.sim = function () { this.shortcuts = [{ pattern: "alt+s" }], this.getstate = function (a) { var b = this.fm; return a = a || b.selected(), !this._disabled && a.length && $.map(a, function (a) { var c = b.file(a); return c && c.phash && !c.locked ? a : null }).length == a.length ? 0 : -1 }, this.exec = function (a) { var c = this.fm, d = $.Deferred().fail(function (a) { a && c.error(a) }), e = this.files(a), f = e.length, g = c.cwd().hash, h = !1; return !f || this._disabled ? d.reject() : ($.each(e, function (a, b) { return b.phash ? b.locked ? !d.reject(["errLocked", b.name]) : (b.hash == g && (h = c.root(b.hash)), void 0) : !d.reject(["errSim", b.name, "errPerm"]) }), "pending" == d.state() && (e = this.hashes(a), c.lockfiles({ files: e }), c.request({ data: { cmd: "sim", targets: e }, notify: { type: "sim", cnt: f }, preventFail: !0 }).fail(function (a) { d.reject(a) }).done(function (a) { d.done(a) }).always(function () { c.unlockfiles({ files: e }) })), d) } }, elFinder.prototype.commands.up = function () { this.alwaysEnabled = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+up" }], this.getstate = function () { return this.fm.cwd().phash ? 0 : -1 }, this.exec = function () { return this.fm.cwd().phash ? this.fm.exec("open", this.fm.cwd().phash) : $.Deferred().reject() } }, elFinder.prototype.commands.upload = function () { var a = this.fm.res("class", "hover"); this.disableOnSearch = !0, this.updateOnSelect = !1, this.shortcuts = [{ pattern: "ctrl+u" }], this.getstate = function () { return !this._disabled && this.fm.cwd().write ? 0 : -1 }, this.exec = function (b) { var e, f, g, h, i, c = this.fm, d = function (a) { f.elfinderdialog("close"), c.upload(a).fail(function (a) { e.reject(a) }).done(function (a) { e.resolve(a) }) }; return this.disabled() ? $.Deferred().reject() : b && (b.input || b.files) ? c.upload(b) : (e = $.Deferred(), g = $('<input type="file" multiple="true"/>').change(function () { d({ input: g[0] }) }), h = $('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">' + c.i18n("selectForUpload") + "</span></div>").append($("<form/>").append(g)).hover(function () { h.toggleClass(a) }), f = $('<div class="elfinder-upload-dialog-wrapper"/>').append(h), c.dragUpload && (i = $('<div class="ui-corner-all elfinder-upload-dropbox">' + c.i18n("dropFiles") + "</div>").prependTo(f).after('<div class="elfinder-upload-dialog-or">' + c.i18n("or") + "</div>")[0], i.addEventListener("dragenter", function (b) { b.stopPropagation(), b.preventDefault(), $(i).addClass(a) }, !1), i.addEventListener("dragleave", function (b) { b.stopPropagation(), b.preventDefault(), $(i).removeClass(a) }, !1), i.addEventListener("dragover", function (a) { a.stopPropagation(), a.preventDefault() }, !1), i.addEventListener("drop", function (a) { a.stopPropagation(), a.preventDefault(), d({ files: a.dataTransfer.files }) }, !1)), c.dialog(f, { title: this.title, modal: !0, resizable: !1, destroyOnClose: !0 }), e) } }, elFinder.prototype.commands.view = function () { this.value = this.fm.viewType, this.alwaysEnabled = !0, this.updateOnSelect = !1, this.options = { ui: "viewbutton" }, this.getstate = function () { return 0 }, this.exec = function () { var a = this.fm.storage("view", "list" == this.value ? "icons" : "list"); this.fm.viewchange(), this.update(void 0, a) } };