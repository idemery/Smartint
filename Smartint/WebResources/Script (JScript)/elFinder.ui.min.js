"use strict"; $.fn.elfinderstat = function (a) { return this.each(function () { var b = $(this).addClass("elfinder-stat-size"), c = $('<div class="elfinder-stat-selected"/>'), d = a.i18n("size").toLowerCase(), e = a.i18n("items").toLowerCase(), f = a.i18n("selected"), g = function (c, f) { var g = 0, h = 0; $.each(c, function (a, b) { f && b.phash != f || (g++, h += parseInt(b.size) || 0) }), b.html(e + ": " + g + ", " + d + ": " + a.formatSize(h)) }; a.getUI("statusbar").prepend(b).append(c).show(), a.bind("open reload add remove change searchend", function () { g(a.files(), a.cwd().hash) }).search(function (a) { g(a.data.files) }).select(function () { var b = 0, e = 0, g = a.selectedFiles(); return 1 == g.length ? (b = g[0].size, c.html(a.escape(g[0].name) + (b > 0 ? ", " + a.formatSize(b) : "")), void 0) : ($.each(g, function (a, c) { e++, b += parseInt(c.size) || 0 }), c.html(e ? f + ": " + e + ", " + d + ": " + a.formatSize(b) : "&nbsp;"), void 0) }) }) }, $.fn.elfindertoolbar = function (a, b) { return this.not(".elfinder-toolbar").each(function () { var g, h, i, j, c = a._commands, d = $(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"), e = b || [], f = e.length; for (d.prev().length && d.parent().prepend(this) ; f--;) if (e[f]) { for (i = $('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'), g = e[f].length; g--;) (h = c[e[f][g]]) && (j = "elfinder" + h.options.ui, $.fn[j] && i.prepend($("<div/>")[j](h))); i.children().length && d.prepend(i), i.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>') } d.children().length && d.show() }), this }, $.fn.elfindertree = function (a, b) { var c = a.res("class", "tree"); return this.not("." + c).each(function () { var d = "class", e = a.res(d, "treeroot"), f = b.openRootOnLoad, g = a.res(d, "navsubtree"), h = a.res(d, "treedir"), i = a.res(d, "navcollapse"), j = a.res(d, "navexpand"), k = "elfinder-subtree-loaded", l = a.res(d, "navarrow"), m = a.res(d, "active"), n = a.res(d, "adroppable"), o = a.res(d, "hover"), p = a.res(d, "disabled"), q = a.res(d, "draggable"), r = a.res(d, "droppable"), s = function (a) { var b = J.offset().left; return a >= b && a <= b + J.width() }, t = a.droppable.drop, u = $.extend(!0, {}, a.droppable, { over: function (a) { var b = $(this), c = o + " " + n; s(a.clientX) ? (b.addClass(c), b.is("." + i + ":not(." + j + ")") && setTimeout(function () { b.is("." + n) && b.children("." + l).click() }, 500)) : b.removeClass(c) }, out: function () { $(this).removeClass(o + " " + n) }, drop: function (a, b) { s(a.clientX) && t.call(this, a, b) } }), v = $(a.res("tpl", "navspinner")), w = a.res("tpl", "navdir"), x = a.res("tpl", "perms"), y = a.res("tpl", "symlink"), z = { id: function (b) { return a.navHash2Id(b.hash) }, cssclass: function (b) { return (b.phash ? "" : e) + " " + h + " " + a.perms2class(b) + " " + (b.dirs && !b.link ? i : "") }, permissions: function (a) { return a.read && a.write ? "" : x }, symlink: function (a) { return a.alias ? y : "" } }, A = function (b) { return b.name = a.escape(b.i18 || b.name), w.replace(/(?:\{([a-z]+)\})/gi, function (a, c) { return b[c] || (z[c] ? z[c](b) : "") }) }, B = function (a) { return $.map(a || [], function (a) { return "directory" == a.mime ? a : null }) }, C = function (b) { return b ? I.find("#" + a.navHash2Id(b)).next("." + g) : I }, D = function (b, c) { for (var e, d = b.children(":first") ; d.length;) { if (e = a.file(a.navId2Hash(d.children("[id]").attr("id"))), (e = a.file(a.navId2Hash(d.children("[id]").attr("id")))) && c.name.toLowerCase().localeCompare(e.name.toLowerCase()) < 0) return d; d = d.next() } return $("") }, E = function (b) { for (var f, g, h, i, c = b.length, d = [], e = b.length; e--;) f = b[e], I.find("#" + a.navHash2Id(f.hash)).length || ((h = C(f.phash)).length ? (g = A(f), f.phash && (i = D(h, f)).length ? i.before(g) : h[f.phash ? "append" : "prepend"](g)) : d.push(f)); return d.length && d.length < c ? E(d) : (setTimeout(function () { G() }, 10), void 0) }, F = function () { var l, n, d = a.cwd().hash, i = I.find("#" + a.navHash2Id(d)); if (f && (l = I.find("#" + a.navHash2Id(a.root())), l.is("." + k) && l.addClass(j).next("." + g).show(), f = !1), i.is("." + m) || (I.find("." + h + "." + m).removeClass(m), i.addClass(m)), b.syncTree) { if (i.length) return i.parentsUntil("." + e).filter("." + g).show().prev("." + h).addClass(j); if (a.newAPI) { if (n = a.file(d), n && n.phash && I.find("#" + a.navHash2Id(n.phash)).length) return E([n]), F(); a.request({ data: { cmd: "parents", target: d }, preventFail: !0 }).done(function (b) { var c = B(b.tree); E(c), H(c, k), d == a.cwd().hash && F(!0) }) } } }, G = function () { I.find("." + h + ":not(." + r + ",.elfinder-ro,.elfinder-na)").droppable(u) }, H = function (b, c) { var d = c == k ? "." + i + ":not(." + k + ")" : ":not(." + i + ")"; $.each(b, function (b, e) { I.find("#" + a.navHash2Id(e.phash) + d).filter(function () { return $(this).next("." + g).children().length > 0 }).addClass(c) }) }, I = $(this).addClass(c).delegate("." + h, "hover", function (b) { var c = $(this), d = "mouseenter" == b.type; c.is("." + n + " ,." + p) || (d && !c.is("." + e + ",." + q + ",.elfinder-na,.elfinder-wo") && c.draggable(a.draggable), c.toggleClass(o, d)) }).delegate("." + h, "dropover dropout drop", function (a) { $(this)["dropover" == a.type ? "addClass" : "removeClass"](n + " " + o) }).delegate("." + h, "click", function () { var c = $(this), d = a.navId2Hash(c.attr("id")), e = a.file(d); a.trigger("searchend"), d == a.cwd().hash || c.is("." + p) ? c.is("." + i) && c.children("." + l).click() : a.exec("open", e.thash || d) }).delegate("." + h + "." + i + " ." + l, "click", function (b) { var c = $(this), d = c.parent("." + h), e = d.next("." + g); b.stopPropagation(), d.is("." + k) ? (d.toggleClass(j), e.slideToggle()) : (v.insertBefore(c), d.removeClass(i), a.request({ cmd: "tree", target: a.navId2Hash(d.attr("id")) }).done(function (a) { E(B(a.tree)), e.children().length && (d.addClass(i + " " + j), e.slideDown()), F() }).always(function () { v.remove(), d.addClass(k) })) }).delegate("." + h, "contextmenu", function (b) { b.preventDefault(), a.trigger("contextmenu", { type: "navbar", targets: [a.navId2Hash($(this).attr("id"))], x: b.clientX, y: b.clientY }) }), J = a.getUI("navbar").append(I).show(); a.open(function (a) { var b = a.data, c = B(b.files); b.init && I.empty(), c.length && (E(c), H(c, k)), F() }).add(function (a) { var b = B(a.data.added); b.length && (E(b), H(b, i)) }).change(function (b) { for (var e, f, i, l, m, n, o, p, q, c = B(b.data.changed), d = c.length; d--;) if (e = c[d], (f = I.find("#" + a.navHash2Id(e.hash))).length) { if (e.phash) { if (l = f.closest("." + g), m = C(e.phash), n = f.parent().next(), o = D(m, e), !m.length) continue; (m[0] !== l[0] || n.get(0) !== o.get(0)) && (o.length ? o.before(f) : m.append(f)) } p = f.is("." + j), q = f.is("." + k), i = $(A(e)), f.replaceWith(i.children("." + h)), e.dirs && (p || q) && (f = I.find("#" + a.navHash2Id(e.hash))) && f.next("." + g).children().length && (p && f.addClass(j), q && f.addClass(k)) } F(), G() }).remove(function (b) { for (var e, f, c = b.data.removed, d = c.length; d--;) (e = I.find("#" + a.navHash2Id(c[d]))).length && (f = e.closest("." + g), e.parent().detach(), f.children().length || f.hide().prev("." + h).removeClass(i + " " + j + " " + k)) }).bind("search searchend", function (b) { I.find("#" + a.navHash2Id(a.cwd().hash))["search" == b.type ? "removeClass" : "addClass"](m) }).bind("lockfiles unlockfiles", function (b) { var c = "lockfiles" == b.type, d = c ? "disable" : "enable", e = $.map(b.data.files || [], function (b) { var c = a.file(b); return c && "directory" == c.mime ? b : null }); $.each(e, function (b, e) { var f = I.find("#" + a.navHash2Id(e)); f.length && (f.is("." + q) && f.draggable(d), f.is("." + r) && f.droppable(m), f[c ? "addClass" : "removeClass"](p)) }) }) }), this }, $.fn.elfinderuploadbutton = function (a) { return this.each(function () { var b = $(this).elfinderbutton(a).unbind("click"), c = $("<form/>").appendTo(b), d = $('<input type="file" multiple="true"/>').change(function () { var b = $(this); b.val() && (a.exec({ input: b.remove()[0] }), d.clone(!0).appendTo(c)) }); c.append(d.clone(!0)), a.change(function () { c[a.disabled() ? "hide" : "show"]() }).change() }) }, $.fn.elfinderviewbutton = function (a) { return this.each(function () { var b = $(this).elfinderbutton(a), c = b.children(".elfinder-button-icon"); a.change(function () { var d = "icons" == a.value; c.toggleClass("elfinder-button-icon-view-list", d), b.attr("title", a.fm.i18n(d ? "viewlist" : "viewicons")) }) }) }, $.fn.elfinderworkzone = function () { var b = "elfinder-workzone"; return this.not("." + b).each(function () { var a = $(this).addClass(b), c = a.outerHeight(!0) - a.height(), d = a.parent(); d.add(window).bind("resize", function () { var e = d.height(); d.children(":visible:not(." + b + ")").each(function () { var a = $(this); "absolute" != a.css("position") && (e -= a.outerHeight(!0)) }), a.height(e - c) }) }), this }, $.fn.elfinderbutton = function (a) { return this.each(function () { var i, b = "class", c = a.fm, d = c.res(b, "disabled"), e = c.res(b, "active"), f = c.res(b, "hover"), g = "elfinder-button-menu-item", h = "elfinder-button-menu-item-selected", j = $(this).addClass("ui-state-default elfinder-button").attr("title", a.title).append('<span class="elfinder-button-icon elfinder-button-icon-' + a.name + '"/>').hover(function (a) { !j.is("." + d) && j["mouseleave" == a.type ? "removeClass" : "addClass"](f) }).click(function (b) { j.is("." + d) || (i && a.variants.length > 1 ? (i.is(":hidden") && a.fm.getUI().click(), b.stopPropagation(), i.slideToggle(100)) : a.exec()) }), k = function () { i.hide() }; $.isArray(a.variants) && (j.addClass("elfinder-menubutton"), i = $('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(j).zIndex(12 + j.zIndex()).delegate("." + g, "hover", function () { $(this).toggleClass(f) }).delegate("." + g, "click", function (b) { b.preventDefault(), b.stopPropagation(), j.removeClass(f), a.exec(a.fm.selected(), $(this).data("value")) }), a.fm.bind("disable select", k).getUI().click(k), a.change(function () { i.html(""), $.each(a.variants, function (b, c) { i.append($('<div class="' + g + '">' + c[1] + "</div>").data("value", c[0]).addClass(c[0] == a.value ? h : "")) }) })), a.change(function () { a.disabled() ? j.removeClass(e + " " + f).addClass(d) : (j.removeClass(d), j[a.active() ? "addClass" : "removeClass"](e)) }).change() }) }, $.fn.elfindercwd = function (a, b) { return this.not(".elfinder-cwd").each(function () { var c = "list" == a.viewType, e = "select." + a.namespace, f = "unselect." + a.namespace, g = "disable." + a.namespace, h = "enable." + a.namespace, i = "class", j = a.res(i, "cwdfile"), k = "." + j, l = "ui-selected", m = a.res(i, "disabled"), n = a.res(i, "draggable"), o = a.res(i, "droppable"), p = a.res(i, "hover"), q = a.res(i, "adroppable"), r = j + "-tmp", s = a.options.loadTmbs > 0 ? a.options.loadTmbs : 5, t = "", u = [], v = { icon: '<div id="{hash}" class="' + j + ' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>', row: '<tr id="{hash}" class="' + j + ' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>' }, w = a.res("tpl", "perms"), x = a.res("tpl", "symlink"), y = { permsclass: function (b) { return a.perms2class(b) }, perms: function (b) { return a.formatPermissions(b) }, dirclass: function (a) { return "directory" == a.mime ? "directory" : "" }, mime: function (b) { return a.mime2class(b.mime) }, size: function (b) { return a.formatSize(b.size) }, date: function (b) { return a.formatDate(b) }, kind: function (b) { return a.mime2kind(b) }, marker: function (a) { return (a.alias || "symlink-broken" == a.mime ? x : "") + (a.read && a.write ? "" : w) }, tooltip: function (b) { var c = a.formatDate(b) + (b.size > 0 ? " (" + a.formatSize(b.size) + ")" : ""); return b.tooltip ? a.escape(b.tooltip).replace(/"/g, "&quot;").replace(/\r/g, "&#13;") + "&#13;" + c : c } }, z = function (b) { return b.name = a.escape(b.name), v[c ? "row" : "icon"].replace(/\{([a-z]+)\}/g, function (a, c) { return y[c] ? y[c](b) : b[c] ? b[c] : "" }) }, A = !1, B = function (a, b) { function q(a, b) { return a[b + "All"]("[id]:not(." + m + "):not(.elfinder-cwd-parent):first") } var j, k, n, o, p, d = $.ui.keyCode, g = a == d.LEFT || a == d.UP, h = V.find("[id]." + l); if (h.length) if (j = h.filter(g ? ":first" : ":last"), n = q(j, g ? "prev" : "next"), n.length) if (c || a == d.LEFT || a == d.RIGHT) k = n; else if (o = j.position().top, p = j.position().left, k = j, g) { do k = k.prev("[id]"); while (k.length && !(k.position().top < o && k.position().left <= p)); k.is("." + m) && (k = q(k, "next")) } else { do k = k.next("[id]"); while (k.length && !(k.position().top > o && k.position().left >= p)); k.is("." + m) && (k = q(k, "prev")), k.length || (n = V.find("[id]:not(." + m + "):last"), n.position().top > o && (k = n)) } else k = j; else k = V.find("[id]:not(." + m + "):not(.elfinder-cwd-parent):" + (g ? "last" : "first")); k && k.length && !k.is(".elfinder-cwd-parent") && (b ? k = j.add(j[g ? "prevUntil" : "nextUntil"]("#" + k.attr("id"))).add(k) : h.trigger(f), k.trigger(e), I(k.filter(g ? ":first" : ":last")), H()) }, C = [], D = function (a) { V.find("#" + a).trigger(e) }, E = function () { var b = a.cwd().hash; V.find("[id]:not(." + l + "):not(.elfinder-cwd-parent)").trigger(e), C = $.map(a.files(), function (a) { return a.phash == b ? a.hash : null }), H() }, F = function () { C = [], V.find("[id]." + l).trigger(f), H() }, H = function () { a.trigger("select", { selected: C }) }, I = function (a) { var b = a.position().top, c = a.outerHeight(!0), d = W.scrollTop(), e = W.innerHeight(); b + c > d + e ? W.scrollTop(parseInt(b + c - e)) : d > b && W.scrollTop(b) }, J = [], K = function (a) { for (var b = J.length; b--;) if (J[b].hash == a) return b; return -1 }, L = "scroll." + a.namespace, M = function () { var k, b = [], d = !1, f = [], g = {}, h = V.find("[id]:last"), i = !h.length, j = c ? V.children("table").children("tbody") : V; if (!J.length) return W.unbind(L); for (; (!h.length || h.position().top <= W.height() + W.scrollTop() + a.options.showThreshold) && (k = J.splice(0, a.options.showFiles)).length;) b = $.map(k, function (a) { return a.hash && a.name ? ("directory" == a.mime && (d = !0), a.tmb && (1 === a.tmb ? f.push(a.hash) : g[a.hash] = a.tmb), z(a)) : null }), j.append(b.join("")), h = V.find("[id]:last"), i && V.scrollTop(0); P(g), f.length && Q(f), d && O(), C.length && j.find("[id]:not(." + l + "):not(.elfinder-cwd-parent)").each(function () { var a = this.id; -1 !== $.inArray(a, C) && $(this).trigger(e) }) }, N = $.extend({}, a.droppable, { over: function (b, c) { var d = a.cwd().hash; $.each(c.helper.data("files"), function (b, c) { return a.file(c).phash == d ? (V.removeClass(q), !1) : void 0 }) } }), O = function () { setTimeout(function () { V.find(".directory:not(." + o + ",.elfinder-na,.elfinder-ro)").droppable(a.droppable) }, 20) }, P = function (b) { var e, c = a.option("tmbUrl"), d = !0; return $.each(b, function (a, b) { var f; b.hash && (a = b.hash, f = b.alt_tmb, b = b.tmb); var g = V.find("#" + a); g.length ? function (a, b) { $("<img/>").load(function () { a.find(".elfinder-cwd-icon").css("background", "url('" + b + "') center center no-repeat") }).attr("src", f) }(g, c + b) : (d = !1, -1 != (e = K(a)) && (J[e].tmb = b)) }), d }, Q = function (b) { var c = []; return a.oldAPI ? (a.request({ data: { cmd: "tmb", current: a.cwd().hash }, preventFail: !0 }).done(function (a) { P(a.images || []) && a.tmb && Q() }), void 0) : (c = c = b.splice(0, s), c.length && a.request({ data: { cmd: "tmb", targets: c }, preventFail: !0 }).done(function (a) { P(a.images || []) && Q(b) }), void 0) }, R = function (b) { for (var k, l, m, n, d = c ? V.find("tbody") : V, e = b.length, f = [], g = {}, h = !1, i = function (b) { for (var d, c = V.find("[id]:first") ; c.length;) { if (d = a.file(c.attr("id")), !c.is(".elfinder-cwd-parent") && d && a.compare(b, d) < 0) return c; c = c.next("[id]") } }, j = function (b) { var d, c = J.length; for (d = 0; c > d; d++) if (a.compare(b, J[d]) < 0) return d; return c || -1 }; e--;) k = b[e], l = k.hash, V.find("#" + l).length || ((m = i(k)) && m.length ? m.before(z(k)) : (n = j(k)) >= 0 ? J.splice(n, 0, k) : d.append(z(k)), V.find("#" + l).length && ("directory" == k.mime ? h = !0 : k.tmb && (1 === k.tmb ? f.push(l) : g[l] = k.tmb))); P(g), f.length && Q(f), h && O() }, S = function (b) { for (var d, e, f, c = b.length; c--;) if (d = b[c], (e = V.find("#" + d)).length) try { e.detach() } catch (g) { a.debug("error", g) } else -1 != (f = K(d)) && J.splice(f, 1) }, T = { name: a.i18n("name"), perm: a.i18n("perms"), mod: a.i18n("modify"), size: a.i18n("size"), kind: a.i18n("kind") }, U = function (d, e) { var f = a.cwd().hash; F(); try { V.children("table," + k).remove() } catch (g) { V.html("") } if (V.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-" + (c ? "list" : "icons")), W[c ? "addClass" : "removeClass"]("elfinder-cwd-wrapper-list"), c && V.html('<table><thead><tr class="ui-state-default"><td >' + T.name + "</td><td>" + T.perm + "</td><td>" + T.mod + "</td><td>" + T.size + "</td><td>" + T.kind + "</td></tr></thead><tbody/></table>"), J = $.map(d, function (a) { return e || a.phash == f ? a : null }), J = a.sortFiles(J), W.bind(L, M).trigger(L), f = a.cwd().phash, b.oldSchool && f && !t) { var h = $.extend(!0, {}, a.file(f), { name: "..", mime: "directory" }); h = $(z(h)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup dblclick mouseenter", function (a) { a.preventDefault(), a.stopPropagation() }).dblclick(function () { a.exec("open", this.id) }), (c ? V.find("tbody") : V).prepend(h) } }, V = $(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable", "on").delegate(k, "click." + a.namespace, function (a) { var i, b = this.id ? $(this) : $(this).parents("[id]:first"), c = b.prevAll("." + l + ":first"), d = b.nextAll("." + l + ":first"), g = c.length, h = d.length; a.stopImmediatePropagation(), a.shiftKey && (g || h) ? (i = g ? b.prevUntil("#" + c.attr("id")) : b.nextUntil("#" + d.attr("id")), i.add(b).trigger(e)) : a.ctrlKey || a.metaKey ? b.trigger(b.is("." + l) ? f : e) : (F(), b.trigger(e)), H() }).delegate(k, "dblclick." + a.namespace, function () { a.dblclick({ file: this.id }) }).delegate(k, "mouseenter." + a.namespace, function () { var d = $(this), e = c ? d : d.children(); d.is("." + r) || e.is("." + n + ",." + m) || e.draggable(a.draggable) }).delegate(k, e, function () { var b = $(this), c = b.attr("id"); A || b.is("." + m) || (b.addClass(l).children().addClass(p), -1 === $.inArray(c, C) && C.push(c)) }).delegate(k, f, function () { var d, b = $(this), c = b.attr("id"); A || ($(this).removeClass(l).children().removeClass(p), d = $.inArray(c, C), -1 !== d && C.splice(d, 1)) }).delegate(k, g, function () { var a = $(this).removeClass(l).addClass(m), b = (c ? a : a.children()).removeClass(p); a.is("." + o) && a.droppable("disable"), b.is("." + n) && b.draggable("disable"), !c && b.removeClass(m) }).delegate(k, h, function () { var a = $(this).removeClass(m), b = c ? a : a.children(); a.is("." + o) && a.droppable("enable"), b.is("." + n) && b.draggable("enable") }).delegate(k, "scrolltoview", function () { I($(this)) }).delegate(k, "hover", function (b) { a.trigger("hover", { hash: $(this).attr("id"), type: b.type }) }).bind("contextmenu." + a.namespace, function (b) { var c = $(b.target).closest("." + j); c.length && (b.stopPropagation(), b.preventDefault(), c.is("." + m) || (c.is("." + l) || (F(), c.trigger(e), H()), a.trigger("contextmenu", { type: "files", targets: a.selected(), x: b.clientX, y: b.clientY }))) }).selectable({ filter: k, stop: H, selected: function (a, b) { $(b.selected).trigger(e) }, unselected: function (a, b) { $(b.unselected).trigger(f) } }).droppable(N).bind("create." + a.namespace, function (a, b) { var d = c ? V.find("tbody") : V, e = d.find(".elfinder-cwd-parent"), b = $(z(b)).addClass(r); F(), e.length ? e.after(b) : d.prepend(b), V.scrollTop(0) }).bind("unselectall", F).bind("selectfile", function (a, b) { V.find("#" + b).trigger(e), H() }), W = $('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu", function (b) { b.preventDefault(), a.trigger("contextmenu", { type: "cwd", targets: [a.cwd().hash], x: b.clientX, y: b.clientY }) }), X = function () { var a = 0; W.siblings(".elfinder-panel:visible").each(function () { a += $(this).outerHeight(!0) }), W.height(Z.height() - a) }, Y = $(this).parent().resize(X), Z = Y.children(".elfinder-workzone").append(W.append(this)); a.dragUpload && (W[0].addEventListener("dragenter", function (a) { a.preventDefault(), a.stopPropagation(), W.addClass(q) }, !1), W[0].addEventListener("dragleave", function (a) { a.preventDefault(), a.stopPropagation(), a.target == V[0] && W.removeClass(q) }, !1), W[0].addEventListener("dragover", function (a) { a.preventDefault(), a.stopPropagation() }, !1), W[0].addEventListener("drop", function (b) { b.preventDefault(), W.removeClass(q), b.dataTransfer && b.dataTransfer.files && b.dataTransfer.files.length && a.exec("upload", { files: b.dataTransfer.files }) }, !1)), a.bind("open", function (a) { U(a.data.files) }).bind("search", function (a) { u = a.data.files, U(u, !0) }).bind("searchend", function () { u = [], t && (t = "", U(a.files())) }).bind("searchstart", function (a) { t = a.data.query }).bind("sortchange", function () { U(t ? u : a.files(), !!t) }).bind("viewchange", function () { var b = a.selected(), d = "list" == a.storage("view"); d != c && (c = d, U(a.files()), $.each(b, function (a, b) { D(b) }), H()), X() }).add(function (b) { var c = a.cwd().hash, d = t ? $.map(b.data.added || [], function (a) { return -1 === a.name.indexOf(t) ? null : a }) : $.map(b.data.added || [], function (a) { return a.phash == c ? a : null }); R(d) }).change(function (b) { var c = a.cwd().hash, d = a.selected(); t ? $.each(b.data.changed || [], function (a, b) { S([b.hash]), -1 !== b.name.indexOf(t) && (R([b]), -1 !== $.inArray(b.hash, d) && D(b.hash)) }) : $.each($.map(b.data.changed || [], function (a) { return a.phash == c ? a : null }), function (a, b) { S([b.hash]), R([b]), -1 !== $.inArray(b.hash, d) && D(b.hash) }), H() }).remove(function (a) { S(a.data.removed || []), H() }).bind("open add search searchend", function () { V.css("height", "auto"), V.outerHeight(!0) < W.height() && V.height(W.height() - (V.outerHeight(!0) - V.height()) - 2) }).dragstart(function (a) { var b = $(a.data.target), c = a.data.originalEvent; b.is(k) && (b.is("." + l) || (!(c.ctrlKey || c.metaKey || c.shiftKey) && F(), b.trigger(e), H()), V.droppable("disable")), V.selectable("disable").removeClass(m), A = !0 }).dragstop(function () { V.selectable("enable").droppable("enable"), A = !1 }).bind("lockfiles unlockfiles", function (a) { for (var b = "lockfiles" == a.type ? g : h, c = a.data.files || [], d = c.length; d--;) V.find("#" + c[d]).trigger(b); H() }).bind("mkdir mkfile duplicate upload rename archive extract", function (b) { var c = a.cwd().hash; F(), $.each(b.data.added || [], function (a, b) { b && b.phash == c && D(b.hash) }), H() }).shortcut({ pattern: "ctrl+a", description: "selectall", callback: E }).shortcut({ pattern: "left right up down shift+left shift+right shift+up shift+down", description: "selectfiles", type: "keydown", callback: function (a) { B(a.keyCode, a.shiftKey) } }).shortcut({ pattern: "home", description: "selectffile", callback: function () { F(), I(V.find("[id]:first").trigger(e)), H() } }).shortcut({ pattern: "end", description: "selectlfile", callback: function () { F(), I(V.find("[id]:last").trigger(e)), H() } }) }), this }, $.fn.elfindercontextmenu = function (a) { return this.each(function () { var b = $(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-" + a.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item", "hover", function () { $(this).toggleClass("ui-state-hover") }), c = "ltr" == a.direction ? "left" : "right", d = $.extend({}, a.options.contextmenu), e = '<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}</span></div>', f = function (a, b, c) { return $(e.replace("{icon}", b ? "elfinder-button-icon-" + b : "").replace("{label}", a)).click(function (a) { a.stopPropagation(), a.stopPropagation(), c() }) }, g = function (d, e) { var f = $(window), g = b.outerWidth(), h = b.outerHeight(), i = f.width(), j = f.height(), k = f.scrollTop(), l = f.scrollLeft(), m = { top: (j > e + h ? e : e - h > 0 ? e - h : e) + k, left: (i > d + g ? d : d - g) + l, "z-index": 100 + a.getUI("workzone").zIndex() }; b.css(m).show(), m = { "z-index": m["z-index"] + 10 }, m[c] = parseInt(b.width()), b.find(".elfinder-contextmenu-sub").css(m) }, h = function () { b.hide().empty() }, i = function (c, e) { var g = !1; $.each(d[c] || [], function (c, d) { var i, j, k; if ("|" == d && g) return b.append('<div class="elfinder-contextmenu-separator"/>'), g = !1, void 0; if (i = a.command(d), i && -1 != i.getstate(e)) { if (i.variants) { if (!i.variants.length) return; j = f(i.title, i.name, function () { }), k = $('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(j.append('<span class="elfinder-contextmenu-arrow"/>')), j.addClass("elfinder-contextmenu-group").hover(function () { k.toggle() }), $.each(i.variants, function (a, b) { k.append($('<div class="elfinder-contextmenu-item"><span>' + b[1] + "</span></div>").click(function (a) { a.stopPropagation(), h(), i.exec(e, b[0]) })) }) } else j = f(i.title, i.name, function () { h(), i.exec(e) }); b.append(j), g = !0 } }) }, j = function (a) { $.each(a, function (a, c) { var d; c.label && "function" == typeof c.callback && (d = f(c.label, c.icon, function () { h(), c.callback() }), b.append(d)) }) }; a.one("load", function () { a.bind("contextmenu", function (a) { var c = a.data; h(), c.type && c.targets ? i(c.type, c.targets) : c.raw && j(c.raw), b.children().length && g(c.x, c.y) }).one("destroy", function () { b.remove() }).bind("disable select", h).getUI().click(h) }) }) }, $.fn.elfinderdialog = function (a) { var b; return "string" == typeof a && (b = this.closest(".ui-dialog")).length && ("open" == a ? "none" == b.css("display") && b.fadeIn(120, function () { b.trigger("open") }) : "close" == a ? "none" != b.css("display") && b.hide().trigger("close") : "destroy" == a ? b.hide().remove() : "toTop" == a && b.trigger("totop")), a = $.extend({}, $.fn.elfinderdialog.defaults, a), this.filter(":not(.ui-dialog-content)").each(function () { var n, b = $(this).addClass("ui-dialog-content ui-widget-content"), c = b.parent(), d = "elfinder-dialog-active", e = "elfinder-dialog", f = "elfinder-dialog-notify", g = "ui-state-hover", h = parseInt(1e6 * Math.random()), i = c.children(".elfinder-overlay"), j = $('<div class="ui-dialog-buttonset"/>'), k = $('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(j), l = $('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  ' + e + " " + a.cssClass + '"/>').hide().append(b).appendTo(c).draggable({ handle: ".ui-dialog-titlebar", containment: $("body") }).css({ width: a.width, height: a.height }).mousedown(function (a) { a.stopPropagation(), $(document).mousedown(), l.is("." + d) || (c.find("." + e + ":visible").removeClass(d), l.addClass(d).zIndex(m() + 1)) }).bind("open", function () { a.modal && i.elfinderoverlay("show"), l.trigger("totop"), "function" == typeof a.open && $.proxy(a.open, b[0])(), l.is("." + f) || c.find("." + e + ":visible").not("." + f).each(function () { var a = $(this), b = parseInt(a.css("top")), c = parseInt(a.css("left")), d = parseInt(l.css("top")), e = parseInt(l.css("left")); a[0] == l[0] || b != d && c != e || l.css({ top: b + 10 + "px", left: c + 10 + "px" }) }) }).bind("close", function () { var d = c.find(".elfinder-dialog:visible"), e = m(); a.modal && i.elfinderoverlay("hide"), d.length ? d.each(function () { var a = $(this); return a.zIndex() >= e ? (a.trigger("totop"), !1) : void 0 }) : setTimeout(function () { c.mousedown().click() }, 10), "function" == typeof a.close ? $.proxy(a.close, b[0])() : a.destroyOnClose && l.hide().remove() }).bind("totop", function () { $(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus() }), m = function () { var a = c.zIndex() + 10; return c.find("." + e + ":visible").each(function () { var b; this != l[0] && (b = $(this).zIndex(), b > a && (a = b)) }), a }; a.position || (n = parseInt((c.height() - l.outerHeight()) / 2 - 42), a.position = { top: (n > 0 ? n : 0) + "px", left: parseInt((c.width() - l.outerWidth()) / 2) + "px" }), l.css(a.position), a.closeOnEscape && $(document).bind("keyup." + h, function (a) { a.keyCode == $.ui.keyCode.ESCAPE && l.is("." + d) && (b.elfinderdialog("close"), $(document).unbind("keyup." + h)) }), l.prepend($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">' + a.title + "</div>").prepend($('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function (a) { a.preventDefault(), b.elfinderdialog("close") }))), $.each(a.buttons, function (a, c) { var d = $('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">' + a + "</span></button>").click($.proxy(c, b[0])).hover(function (a) { $(this)["mouseenter" == a.type ? "focus" : "blur"]() }).focus(function () { $(this).addClass(g) }).blur(function () { $(this).removeClass(g) }).keydown(function (a) { var b; a.keyCode == $.ui.keyCode.ENTER ? $(this).click() : a.keyCode == $.ui.keyCode.TAB && (b = $(this).next(".ui-button"), b.length ? b.focus() : $(this).parent().children(".ui-button:first").focus()) }); j.append(d) }), j.children().length && l.append(k), a.resizable && $.fn.resizable && l.resizable({ minWidth: a.minWidth, minHeight: a.minHeight, alsoResize: this }), "function" == typeof a.create && $.proxy(a.create, this)(), a.autoOpen && b.elfinderdialog("open") }), this }, $.fn.elfinderdialog.defaults = { cssClass: "", title: "", modal: !1, resizable: !0, autoOpen: !0, closeOnEscape: !0, destroyOnClose: !1, buttons: {}, position: null, width: 320, height: "auto", minWidth: 200, minHeight: 110 }, $.fn.elfindernavbar = function (a, b) { return this.not(".elfinder-navbar").each(function () { var h, c = $(this).addClass("ui-state-default elfinder-navbar"), d = c.parent().resize(function () { c.height(e.height() - f) }), e = d.children(".elfinder-workzone").append(c), f = c.outerHeight() - c.height(), g = "ltr" == a.direction; $.fn.resizable && (h = c.resizable({ handles: g ? "e" : "w", minWidth: b.minWidth || 150, maxWidth: b.maxWidth || 500 }).bind("resize scroll", function () { h.css({ top: parseInt(c.scrollTop()) + "px", left: parseInt(g ? c.width() + c.scrollLeft() - h.width() - 2 : c.scrollLeft() + 2) }) }).find(".ui-resizable-handle").zIndex(c.zIndex() + 10), g || c.resize(function () { c.css("left", null).css("right", 0) }), a.one("open", function () { setTimeout(function () { c.trigger("resize") }, 150) })) }), this }, $.fn.elfinderoverlay = function (a) { if (this.filter(":not(.elfinder-overlay)").each(function () { a = $.extend({}, a), $(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function (a) { a.preventDefault(), a.stopPropagation() }).data({ cnt: 0, show: "function" == typeof a.show ? a.show : function () { }, hide: "function" == typeof a.hide ? a.hide : function () { } }) }), "show" == a) { var b = this.eq(0), c = b.data("cnt") + 1, d = b.data("show"); b.data("cnt", c), b.is(":hidden") && (b.zIndex(b.parent().zIndex() + 1), b.show(), d()) } if ("hide" == a) { var b = this.eq(0), c = b.data("cnt") - 1, e = b.data("hide"); b.data("cnt", c), 0 == c && b.is(":visible") && (b.hide(), e()) } return this }, $.fn.elfinderpanel = function (a) { return this.each(function () { var b = $(this).addClass("elfinder-panel ui-state-default ui-corner-all"), c = "margin-" + ("ltr" == a.direction ? "left" : "right"); a.one("load", function () { var e = a.getUI("navbar"); b.css(c, parseInt(e.outerWidth(!0))), e.bind("resize", function () { b.is(":visible") && b.css(c, parseInt(e.outerWidth(!0))) }) }) }) }, $.fn.elfinderpath = function (a) { return this.each(function () { var b = $(this).addClass("elfinder-path").html("&nbsp;").delegate("a", "click", function (b) { var c = $(this).attr("href").substr(1); b.preventDefault(), c != a.cwd().hash && a.exec("open", c) }).prependTo(a.getUI("statusbar").show()); a.bind("open searchend", function () { var c = []; $.each(a.parents(a.cwd().hash), function (b, d) { c.push('<a href="#' + d + '">' + a.escape(a.file(d).name) + "</a>") }), b.html(c.join(a.option("separator"))) }).bind("search", function () { b.html(a.i18n("searcresult")) }) }) }, $.fn.elfinderplaces = function (a, b) {
    return this.each(function () {
        var c = [], d = "class", e = a.res(d, "navdir"), f = a.res(d, "navcollapse"), g = a.res(d, "navexpand"), i = (a.res(d, "hover"), a.res(d, "treeroot")), j = a.res("tpl", "navdir"), k = a.res("tpl", "perms"), l = $(a.res("tpl", "navspinner")), m = function (a) { return a.substr(6) }, n = function (a) { return "place-" + a }, o = function () { a.storage("places", c.join(",")) }, p = function (b) { return $(j.replace(/\{id\}/, n(b.hash)).replace(/\{name\}/, a.escape(b.name)).replace(/\{cssclass\}/, a.perms2class(b)).replace(/\{permissions\}/, b.read && b.write ? "" : k).replace(/\{symlink\}/, "")) }, q = function (b) { var d = p(b); v.children().length && $.each(v.children(), function () { var a = $(this); return b.name.localeCompare(a.children("." + e).text()) < 0 ? !d.insertBefore(a) : void 0 }), c.push(b.hash), !d.parent().length && v.append(d), u.addClass(f), d.draggable({ appendTo: "body", revert: !1, helper: function () { var b = $(this); return b.children().removeClass("ui-state-hover"), $('<div class="elfinder-place-drag elfinder-' + a.direction + '"/>').append(b.clone()).data("hash", m(b.children(":first").attr("id"))) }, start: function () { $(this).hide() }, stop: function (a, b) { var c = w.offset().top, d = w.offset().left, e = w.width(), f = w.height(), g = a.clientX, h = a.clientY; g > d && d + e > g && h > c && h + f > h ? $(this).show() : (r(b.helper.data("hash")), o()) } }) }, r = function (a) { var b = $.inArray(a, c); -1 !== b && (c.splice(b, 1), v.find("#" + n(a)).parent().remove(), !v.children().length && u.removeClass(f + " " + g)) }, t = p({ hash: "root-" + a.namespace, name: a.i18n(b.name, "places"), read: !0, write: !0 }), u = t.children("." + e).addClass(i).click(function () { u.is("." + f) && (w.toggleClass(g), v.slideToggle(), a.storage("placesState", w.is("." + g) ? 1 : 0)) }), v = t.children("." + a.res(d, "navsubtree")), w = $(this).addClass(a.res(d, "tree") + " elfinder-places ui-corner-all").hide().append(t).appendTo(a.getUI("navbar")).delegate("." + e, "hover", function () { $(this).toggleClass("ui-state-hover") }).delegate("." + e, "click", function () { a.exec("open", $(this).attr("id").substr(6)) }).delegate("." + e + ":not(." + i + ")", "contextmenu", function (b) { var c = $(this).attr("id").substr(6); b.preventDefault(), a.trigger("contextmenu", { raw: [{ label: a.i18n("rmFromPlaces"), icon: "rm", callback: function () { r(c), o() } }], x: b.clientX, y: b.clientY }) }).droppable({ tolerance: "pointer", accept: ".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file", hoverClass: a.res("class", "adroppable"), drop: function (b, d) { var e = !0; $.each(d.helper.data("files"), function (b, d) { var f = a.file(d); f && "directory" == f.mime && -1 === $.inArray(f.hash, c) ? q(f) : e = !1 }), o(), e && d.helper.hide() } }); a.one("load", function () {
            a.oldAPI || (w.show().parent().show(), c = $.map(a.storage("places").split(","), function (a) { return a || null }), c.length && (u.prepend(l), a.request({ data: { cmd: "info", targets: c }, preventDefault: !0 }).done(function (b) {
                c = [], $.each(b.files, function (a, b) { "directory" == b.mime && q(b) }), o(), a.storage("placesState") > 0 && u.click()
            }).always(function () { l.remove() })), a.remove(function (a) { $.each(a.data.removed, function (a, b) { r(b) }), o() }).change(function (a) { $.each(a.data.changed, function (a, b) { -1 !== $.inArray(b.hash, c) && (r(b.hash), "directory" == b.mime && q(b)) }), o() }).bind("sync", function () { c.length && (u.prepend(l), a.request({ data: { cmd: "info", targets: c }, preventDefault: !0 }).done(function (a) { $.each(a.files || [], function (a, b) { -1 === $.inArray(b.hash, c) && r(b.hash) }), o() }).always(function () { l.remove() })) }))
        })
    })
}, $.fn.elfindersearchbutton = function (a) { return this.each(function () { var b = !1, c = $(this).hide().addClass("ui-widget-content elfinder-button " + a.fm.res("class", "searchbtn")), d = function () { var c = $.trim(f.val()); c ? a.exec(c).done(function () { b = !0, f.focus() }) : a.fm.trigger("searchend") }, e = function () { f.val(""), b && (b = !1, a.fm.trigger("searchend")) }, f = $('<input type="text" size="42"/>').appendTo(c).keypress(function (a) { a.stopPropagation() }).keydown(function (a) { a.stopPropagation(), 13 == a.keyCode && d(), 27 == a.keyCode && (a.preventDefault(), e()) }); $('<span class="ui-icon ui-icon-search" title="' + a.title + '"/>').appendTo(c).click(d), $('<span class="ui-icon ui-icon-close"/>').appendTo(c).click(e), setTimeout(function () { if (c.parent().detach(), a.fm.getUI("toolbar").prepend(c.show()), $.browser.msie) { var b = c.children("ltr" == a.fm.direction ? ".ui-icon-close" : ".ui-icon-search"); b.css({ right: "", left: parseInt(c.width()) - b.outerWidth(!0) }) } }, 200), a.fm.error(function () { f.unbind("keydown") }).select(function () { f.blur() }).bind("searchend", function () { f.val("") }).viewchange(e).shortcut({ pattern: "ctrl+f f3", description: a.title, callback: function () { f.select().focus() } }) }) }, $.fn.elfindersortbutton = function (a) { return this.each(function () { var b = a.fm, c = a.name, d = "class", e = b.res(d, "disabled"), f = b.res(d, "hover"), g = "elfinder-button-menu-item", h = g + "-selected", i = h + "-asc", j = h + "-desc", k = $(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-" + c).attr("title", a.title).append('<span class="elfinder-button-icon elfinder-button-icon-' + c + '"/>').hover(function () { !k.is("." + e) && k.toggleClass(f) }).click(function (b) { k.is("." + e) || (b.stopPropagation(), l.is(":hidden") && a.fm.getUI().click(), l.slideToggle(100)) }), l = $('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(k).zIndex(12 + k.zIndex()).delegate("." + g, "hover", function () { $(this).toggleClass(f) }).delegate("." + g, "click", function (a) { a.preventDefault(), a.stopPropagation(), n() }), m = function () { l.children(":not(:last)").removeClass(h + " " + i + " " + j).filter('[rel="' + b.sortType + '"]').addClass(h + " " + ("asc" == b.sortOrder ? i : j)), l.children(":last").toggleClass(h, b.sortStickFolders) }, n = function () { l.hide() }; $.each(b.sortRules, function (a) { l.append($('<div class="' + g + '" rel="' + a + '"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>' + b.i18n("sort" + a) + "</div>").data("type", a)) }), l.children().click(function () { var d = $(this).attr("rel"); a.exec([], { type: d, order: d == b.sortType ? "asc" == b.sortOrder ? "desc" : "asc" : b.sortOrder, stick: b.sortStickFolders }) }), $('<div class="' + g + " " + g + '-separated"><span class="ui-icon ui-icon-check"/>' + b.i18n("sortFoldersFirst") + "</div>").appendTo(l).click(function () { a.exec([], { type: b.sortType, order: b.sortOrder, stick: !b.sortStickFolders }) }), b.bind("disable select", n).getUI().click(n), b.bind("sortchange", m), l.children().length > 1 ? a.change(function () { k.toggleClass(e, a.disabled()), m() }).change() : k.addClass(e) }) };